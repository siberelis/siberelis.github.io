/*! For license information please see hydra-synth.js.LICENSE.txt */
!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Hydra=e()}((function(){var define,module,exports;return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[a]={exports:{}};t[a][0].call(f.exports,(function(e){return i(t[a][1][e]||e)}),f,f.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){var r=Object.create||function(e){var t=function(){};return t.prototype=e,new t},i=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n},o=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function a(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=r(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0;var s,u=10;try{var c={};Object.defineProperty&&Object.defineProperty(c,"x",{value:0}),s=0===c.x}catch(e){s=!1}function f(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function l(e,t,n){if(t)e.call(n);else for(var r=e.length,i=w(e,r),o=0;o<r;++o)i[o].call(n)}function p(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=w(e,i),a=0;a<i;++a)o[a].call(n,r)}function h(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,a=w(e,o),s=0;s<o;++s)a[s].call(n,r,i)}function m(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var a=e.length,s=w(e,a),u=0;u<a;++u)s[u].call(n,r,i,o)}function d(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=w(e,i),a=0;a<i;++a)o[a].apply(n,r)}function y(e,t,n,i){var o,a,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),s=a[t]):(a=e._events=r(null),e._eventsCount=0),s){if("function"==typeof s?s=a[t]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),!s.warned&&(o=f(e))&&o>0&&s.length>o){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",u.name,u.message)}}else s=a[t]=n,++e._eventsCount;return e}function g(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function v(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=o.call(g,r);return i.listener=n,r.wrapFn=i,i}function b(e,t,n){var r=e._events;if(!r)return[];var i=r[t];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):w(i,i.length):[]}function x(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function w(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}s?Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');u=e}}):a.defaultMaxListeners=u,a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return f(this)},a.prototype.emit=function(e){var t,n,r,i,o,a,s="error"===e;if(a=this._events)s=s&&null==a.error;else if(!s)return!1;if(s){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var u=new Error('Unhandled "error" event. ('+t+")");throw u.context=t,u}if(!(n=a[e]))return!1;var c="function"==typeof n;switch(r=arguments.length){case 1:l(n,c,this);break;case 2:p(n,c,this,arguments[1]);break;case 3:h(n,c,this,arguments[1],arguments[2]);break;case 4:m(n,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];d(n,c,this,i)}return!0},a.prototype.addListener=function(e,t){return y(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return y(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,v(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,v(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,i,o,a,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=r(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){s=n[a].listener,o=a;break}if(o<0)return this;0===o?n.shift():function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,o),1===n.length&&(i[e]=n[0]),i.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.removeAllListeners=function(e){var t,n,o;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=r(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=r(null):delete n[e]),this;if(0===arguments.length){var a,s=i(n);for(o=0;o<s.length;++o)"removeListener"!==(a=s[o])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=r(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this},a.prototype.listeners=function(e){return b(this,e,!0)},a.prototype.rawListeners=function(e){return b(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):x.call(e,t)},a.prototype.listenerCount=x,a.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],2:[function(e,t,n){var r,i,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function u(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var c,f=[],l=!1,p=-1;function h(){l&&c&&(l=!1,c.length?f=c.concat(f):p=-1,f.length&&m())}function m(){if(!l){var e=u(h);l=!0;for(var t=f.length;t;){for(c=f,f=[];++p<t;)c&&c[p].run();p=-1,t=f.length}c=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function y(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new d(e,t)),1!==f.length||l||u(m)},d.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=y,o.addListener=y,o.once=y,o.off=y,o.removeListener=y,o.removeAllListeners=y,o.emit=y,o.prependListener=y,o.prependOnceListener=y,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],3:[function(e,t,n){const r=e("./src/output.js"),i=e("raf-loop"),o=e("./src/hydra-source.js"),a=e("./src/lib/mouse.js")(),s=e("./src/lib/audio.js"),u=e("./src/lib/video-recorder.js"),c=e("./src/lib/array-utils.js"),f=e("./src/eval-sandbox.js"),l=e("./src/generator-factory.js");t.exports=class{constructor({pb:e=null,width:t=1280,height:n=720,numSources:r=4,numOutputs:o=4,makeGlobal:s=!0,autoLoop:l=!0,detectAudio:p=!0,enableStreamCapture:h=!0,canvas:m,precision:d,extendTransforms:y={}}={}){if(c.init(),this.pb=e,this.width=t,this.height=n,this.renderAll=!1,this.detectAudio=p,this._initCanvas(m),this.synth={time:0,bpm:30,width:this.width,height:this.height,fps:void 0,stats:{fps:0},speed:1,mouse:a,render:this._render.bind(this),setResolution:this.setResolution.bind(this),update:e=>{},hush:this.hush.bind(this)},s&&(window.loadScript=this.loadScript),this.timeSinceLastUpdate=0,this._time=0,d&&["lowp","mediump","highp"].includes(d.toLowerCase()))this.precision=d.toLowerCase();else{let e=(/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!window.MSStream;this.precision=e?"highp":"mediump"}if(this.extendTransforms=y,this.saveFrame=!1,this.captureStream=null,this.generator=void 0,this._initRegl(),this._initOutputs(o),this._initSources(r),this._generateGlslTransforms(),this.synth.screencap=()=>{this.saveFrame=!0},h)try{this.captureStream=this.canvas.captureStream(25),this.synth.vidRecorder=new u(this.captureStream)}catch(e){console.warn("[hydra-synth warning]\nnew MediaSource() is not currently supported on iOS."),console.error(e)}p&&this._initAudio(),l&&i(this.tick.bind(this)).start(),this.sandbox=new f(this.synth,s,["speed","update","bpm","fps"])}eval(e){this.sandbox.eval(e)}getScreenImage(e){this.imageCallback=e,this.saveFrame=!0}hush(){this.s.forEach((e=>{e.clear()})),this.o.forEach((e=>{this.synth.solid(1,1,1,0).out(e)}))}loadScript(e=""){return new Promise(((t,n)=>{var r=document.createElement("script");r.onload=function(){console.log(`loaded script ${e}`),t()},r.onerror=n=>{console.log(`error loading script ${e}`,"log-error"),t()},r.src=e,document.head.appendChild(r)}))}setResolution(e,t){this.canvas.width=e,this.canvas.height=t,this.width=e,this.height=t,this.o.forEach((n=>{n.resize(e,t)})),this.s.forEach((n=>{n.resize(e,t)})),this.regl._refresh(),console.log(this.canvas.width)}canvasToImage(e){const t=document.createElement("a");t.style.display="none";let n=new Date;t.download=`hydra-${n.getFullYear()}-${n.getMonth()+1}-${n.getDate()}-${n.getHours()}.${n.getMinutes()}.${n.getSeconds()}.png`,document.body.appendChild(t);var r=this;this.canvas.toBlob((e=>{r.imageCallback?(r.imageCallback(e),delete r.imageCallback):(t.href=URL.createObjectURL(e),console.log(t.href),t.click())}),"image/png"),setTimeout((()=>{document.body.removeChild(t),window.URL.revokeObjectURL(t.href)}),300)}_initAudio(){this.synth.a=new s({numBins:4})}_initCanvas(e){e?(this.canvas=e,this.width=e.width,this.height=e.height):(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.imageRendering="pixelated",document.body.appendChild(this.canvas))}_initRegl(){this.regl=e("regl")({canvas:this.canvas,pixelRatio:1}),this.regl.clear({color:[0,0,0,1]}),this.renderAll=this.regl({frag:`\n      precision ${this.precision} float;\n      varying vec2 uv;\n      uniform sampler2D tex0;\n      uniform sampler2D tex1;\n      uniform sampler2D tex2;\n      uniform sampler2D tex3;\n\n      void main () {\n        vec2 st = vec2(1.0 - uv.x, uv.y);\n        st*= vec2(2);\n        vec2 q = floor(st).xy*(vec2(2.0, 1.0));\n        int quad = int(q.x) + int(q.y);\n        st.x += step(1., mod(st.y,2.0));\n        st.y += step(1., mod(st.x,2.0));\n        st = fract(st);\n        if(quad==0){\n          gl_FragColor = texture2D(tex0, st);\n        } else if(quad==1){\n          gl_FragColor = texture2D(tex1, st);\n        } else if (quad==2){\n          gl_FragColor = texture2D(tex2, st);\n        } else {\n          gl_FragColor = texture2D(tex3, st);\n        }\n\n      }\n      `,vert:`\n      precision ${this.precision} float;\n      attribute vec2 position;\n      varying vec2 uv;\n\n      void main () {\n        uv = position;\n        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);\n      }`,attributes:{position:[[-2,0],[0,-2],[2,2]]},uniforms:{tex0:this.regl.prop("tex0"),tex1:this.regl.prop("tex1"),tex2:this.regl.prop("tex2"),tex3:this.regl.prop("tex3")},count:3,depth:{enable:!1}}),this.renderFbo=this.regl({frag:`\n      precision ${this.precision} float;\n      varying vec2 uv;\n      uniform vec2 resolution;\n      uniform sampler2D tex0;\n\n      void main () {\n        gl_FragColor = texture2D(tex0, vec2(1.0 - uv.x, uv.y));\n      }\n      `,vert:`\n      precision ${this.precision} float;\n      attribute vec2 position;\n      varying vec2 uv;\n\n      void main () {\n        uv = position;\n        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);\n      }`,attributes:{position:[[-2,0],[0,-2],[2,2]]},uniforms:{tex0:this.regl.prop("tex0"),resolution:this.regl.prop("resolution")},count:3,depth:{enable:!1}})}_initOutputs(e){const t=this;this.o=Array(e).fill().map(((e,n)=>{var i=new r({regl:this.regl,width:this.width,height:this.height,precision:this.precision,label:`o${n}`});return i.id=n,t.synth["o"+n]=i,i})),this.output=this.o[0]}_initSources(e){this.s=[];for(var t=0;t<e;t++)this.createSource(t)}createSource(e){let t=new o({regl:this.regl,pb:this.pb,width:this.width,height:this.height,label:`s${e}`});return this.synth["s"+this.s.length]=t,this.s.push(t),t}_generateGlslTransforms(){var e=this;this.generator=new l({defaultOutput:this.o[0],defaultUniforms:this.o[0].uniforms,extendTransforms:this.extendTransforms,changeListener:({type:t,method:n,synth:r})=>{"add"===t&&(e.synth[n]=r.generators[n],e.sandbox&&e.sandbox.add(n))}}),this.synth.setFunction=this.generator.setFunction.bind(this.generator)}_render(e){e?(this.output=e,this.isRenderingAll=!1):this.isRenderingAll=!0}tick(e,t){if(this.sandbox.tick(),!0===this.detectAudio&&this.synth.a.tick(),this.synth.update)try{this.synth.update(e)}catch(e){console.log(error)}if(this.sandbox.set("time",this.synth.time+=.001*e*this.synth.speed),this.timeSinceLastUpdate+=e,!this.synth.fps||this.timeSinceLastUpdate>=1e3/this.synth.fps){this.synth.stats.fps=Math.ceil(1e3/this.timeSinceLastUpdate);for(let e=0;e<this.s.length;e++)this.s[e].tick(this.synth.time);for(let e=0;e<this.o.length;e++)this.o[e].tick({time:this.synth.time,mouse:this.synth.mouse,bpm:this.synth.bpm,resolution:[this.canvas.width,this.canvas.height]});this.isRenderingAll?this.renderAll({tex0:this.o[0].getCurrent(),tex1:this.o[1].getCurrent(),tex2:this.o[2].getCurrent(),tex3:this.o[3].getCurrent(),resolution:[this.canvas.width,this.canvas.height]}):this.renderFbo({tex0:this.output.getCurrent(),resolution:[this.canvas.width,this.canvas.height]}),this.timeSinceLastUpdate=0}!0===this.saveFrame&&(this.canvasToImage(),this.saveFrame=!1)}}},{"./src/eval-sandbox.js":11,"./src/generator-factory.js":12,"./src/hydra-source.js":17,"./src/lib/array-utils.js":18,"./src/lib/audio.js":19,"./src/lib/mouse.js":22,"./src/lib/video-recorder.js":25,"./src/output.js":27,"raf-loop":7,regl:9}],4:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],5:[function(e,t,n){var r;r=function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=23)}([function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e){return 700*(Math.exp(e/1125)-1)}function o(e){return 1125*Math.log(1+e/700)}function a(e,t){return Math.log2(16*e/t)}function s(e){var t=e[0].map((function(){return 0})),n=e.reduce((function(e,t){return t.forEach((function(t,n){e[n]+=Math.pow(t,2)})),e}),t).map(Math.sqrt);return e.map((function(e,t){return e.map((function(e,t){return e/(n[t]||1)}))}))}t.b=function(e){for(;e%2==0&&e>1;)e/=2;return 1===e},t.a=function(e,t){if("rect"!==t){if(""!==t&&t||(t="hanning"),c[t]||(c[t]={}),!c[t][e.length])try{c[t][e.length]=u[t](e.length)}catch(e){throw new Error("Invalid windowing function")}e=function(e,t){for(var n=[],r=0;r<Math.min(e.length,t.length);r++)n[r]=e[r]*t[r];return n}(e,c[t][e.length])}return e},t.c=function(e,t,n){for(var r=new Float32Array(e),i=0;i<r.length;i++)r[i]=i*t/n,r[i]=13*Math.atan(r[i]/1315.8)+3.5*Math.atan(Math.pow(r[i]/7518,2));return r},t.f=function(e){return Float32Array.from(e)},t.d=function(e,t,n){for(var r=new Float32Array(e+2),a=new Float32Array(e+2),s=t/2,u=o(0),c=(o(s)-u)/(e+1),f=Array(e+2),l=0;l<r.length;l++)r[l]=l*c,a[l]=i(r[l]),f[l]=Math.floor((n+1)*a[l]/t);for(var p=Array(e),h=0;h<p.length;h++){p[h]=Array.apply(null,new Array(n/2+1)).map(Number.prototype.valueOf,0);for(var m=f[h];m<f[h+1];m++)p[h][m]=(m-f[h])/(f[h+1]-f[h]);for(var d=f[h+1];d<f[h+2];d++)p[h][d]=(f[h+2]-d)/(f[h+2]-f[h+1])}return p},t.e=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,u=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:440,f=Math.floor(n/2)+1,l=new Array(n).fill(0).map((function(r,i){return e*a(t*i/n,c)}));l[0]=l[1]-1.5*e;var p=l.slice(1).map((function(e,t){return Math.max(e-l[t])}),1).concat([1]),h=Math.round(e/2),m=new Array(e).fill(0).map((function(t,n){return l.map((function(t){return(10*e+h+t-n)%e-h}))})),d=m.map((function(e,t){return e.map((function(e,n){return Math.exp(-.5*Math.pow(2*m[t][n]/p[n],2))}))}));if(d=s(d),o){var y=l.map((function(t){return Math.exp(-.5*Math.pow((t/e-i)/o,2))}));d=d.map((function(e){return e.map((function(e,t){return e*y[t]}))}))}return u&&(d=[].concat(r(d.slice(3)),r(d.slice(0,3)))),d.map((function(e){return e.slice(0,f)}))},t.g=function(e,t,n){if(e.length<t)throw new Error("Buffer is too short for frame length");if(n<1)throw new Error("Hop length cannot be less that 1");if(t<1)throw new Error("Frame length cannot be less that 1");var r=1+Math.floor((e.length-t)/n);return new Array(r).fill(0).map((function(r,i){return e.slice(i*n,i*n+t)}))};var u=n(25),c={}},function(e,t,n){"use strict";t.a=function(e,t){for(var n=0,r=0,i=0;i<t.length;i++)n+=Math.pow(i,e)*Math.abs(t[i]),r+=t[i];return n/r}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.a=function(e){if("object"!==r(e.ampSpectrum)||"object"!==r(e.barkScale))throw new TypeError;var t=new Float32Array(24),n=0,i=e.ampSpectrum,o=new Int32Array(25);o[0]=0;for(var a=e.barkScale[i.length-1]/24,s=1,u=0;u<i.length;u++)for(;e.barkScale[u]>a;)o[s++]=u,a=s*e.barkScale[i.length-1]/24;o[24]=i.length-1;for(var c=0;c<24;c++){for(var f=0,l=o[c];l<o[c+1];l++)f+=i[l];t[c]=Math.pow(f,.23)}for(var p=0;p<t.length;p++)n+=t[p];return{specific:t,total:n}}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.a=function(){if("object"!==r(arguments[0].ampSpectrum))throw new TypeError;for(var e=new Float32Array(arguments[0].ampSpectrum.length),t=0;t<e.length;t++)e[t]=Math.pow(arguments[0].ampSpectrum[t],2);return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"buffer",(function(){return x})),n.d(t,"complexSpectrum",(function(){return w})),n.d(t,"amplitudeSpectrum",(function(){return _}));var r=n(13),i=n(9),o=n(20),a=n(14),s=n(18),u=n(15),c=n(21),f=n(19),l=n(17),p=n(22),h=n(2),m=n(12),d=n(11),y=n(10),g=n(8),v=n(3),b=n(16);n.d(t,"rms",(function(){return r.a})),n.d(t,"energy",(function(){return i.a})),n.d(t,"spectralSlope",(function(){return o.a})),n.d(t,"spectralCentroid",(function(){return a.a})),n.d(t,"spectralRolloff",(function(){return s.a})),n.d(t,"spectralFlatness",(function(){return u.a})),n.d(t,"spectralSpread",(function(){return c.a})),n.d(t,"spectralSkewness",(function(){return f.a})),n.d(t,"spectralKurtosis",(function(){return l.a})),n.d(t,"zcr",(function(){return p.a})),n.d(t,"loudness",(function(){return h.a})),n.d(t,"perceptualSpread",(function(){return m.a})),n.d(t,"perceptualSharpness",(function(){return d.a})),n.d(t,"powerSpectrum",(function(){return v.a})),n.d(t,"mfcc",(function(){return y.a})),n.d(t,"chroma",(function(){return g.a})),n.d(t,"spectralFlux",(function(){return b.a}));var x=function(e){return e.signal},w=function(e){return e.complexSpectrum},_=function(e){return e.ampSpectrum}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(4),o=n(28),a=(n.n(o),n(24)),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u={audioContext:null,spn:null,bufferSize:512,sampleRate:44100,melBands:26,chromaBands:12,callback:null,windowingFunction:"hanning",featureExtractors:i,EXTRACTION_STARTED:!1,_featuresToExtract:[],windowing:r.a,_errors:{notPow2:new Error("Meyda: Buffer size must be a power of 2, e.g. 64 or 512"),featureUndef:new Error("Meyda: No features defined."),invalidFeatureFmt:new Error("Meyda: Invalid feature format"),invalidInput:new Error("Meyda: Invalid input."),noAC:new Error("Meyda: No AudioContext specified."),noSource:new Error("Meyda: No source node specified.")},createMeydaAnalyzer:function(e){return new a.a(e,u)},extract:function(e,t,n){if(!t)throw this._errors.invalidInput;if("object"!=(void 0===t?"undefined":s(t)))throw this._errors.invalidInput;if(!e)throw this._errors.featureUndef;if(!r.b(t.length))throw this._errors.notPow2;void 0!==this.barkScale&&this.barkScale.length==this.bufferSize||(this.barkScale=r.c(this.bufferSize,this.sampleRate,this.bufferSize)),void 0!==this.melFilterBank&&this.barkScale.length==this.bufferSize&&this.melFilterBank.length==this.melBands||(this.melFilterBank=r.d(this.melBands,this.sampleRate,this.bufferSize)),void 0!==this.chromaFilterBank&&this.chromaFilterBank.length==this.chromaBands||(this.chromaFilterBank=r.e(this.chromaBands,this.sampleRate,this.bufferSize)),void 0===t.buffer?this.signal=r.f(t):this.signal=t;var i=c(t,this.windowingFunction,this.bufferSize);if(this.signal=i.windowedSignal,this.complexSpectrum=i.complexSpectrum,this.ampSpectrum=i.ampSpectrum,n){var o=c(n,this.windowingFunction,this.bufferSize);this.previousSignal=o.windowedSignal,this.previousComplexSpectrum=o.complexSpectrum,this.previousAmpSpectrum=o.ampSpectrum}if("object"===(void 0===e?"undefined":s(e))){for(var a={},u=0;u<e.length;u++)a[e[u]]=this.featureExtractors[e[u]]({ampSpectrum:this.ampSpectrum,chromaFilterBank:this.chromaFilterBank,complexSpectrum:this.complexSpectrum,signal:this.signal,bufferSize:this.bufferSize,sampleRate:this.sampleRate,barkScale:this.barkScale,melFilterBank:this.melFilterBank,previousSignal:this.previousSignal,previousAmpSpectrum:this.previousAmpSpectrum,previousComplexSpectrum:this.previousComplexSpectrum});return a}if("string"==typeof e)return this.featureExtractors[e]({ampSpectrum:this.ampSpectrum,chromaFilterBank:this.chromaFilterBank,complexSpectrum:this.complexSpectrum,signal:this.signal,bufferSize:this.bufferSize,sampleRate:this.sampleRate,barkScale:this.barkScale,melFilterBank:this.melFilterBank,previousSignal:this.previousSignal,previousAmpSpectrum:this.previousAmpSpectrum,previousComplexSpectrum:this.previousComplexSpectrum});throw this._errors.invalidFeatureFmt}},c=function(e,t,i){var a={};void 0===e.buffer?a.signal=r.f(e):a.signal=e,a.windowedSignal=r.a(a.signal,t),a.complexSpectrum=n.i(o.fft)(a.windowedSignal),a.ampSpectrum=new Float32Array(i/2);for(var s=0;s<i/2;s++)a.ampSpectrum[s]=Math.sqrt(Math.pow(a.complexSpectrum.real[s],2)+Math.pow(a.complexSpectrum.imag[s],2));return a};t.default=u,"undefined"!=typeof window&&(window.Meyda=u)},function(e,t,n){"use strict";(function(t){function r(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0}function i(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}function o(e){return Object.prototype.toString.call(e)}function a(e){return!i(e)&&"function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}function s(e){if(y.isFunction(e)){if(b)return e.name;var t=e.toString().match(w);return t&&t[1]}}function u(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function c(e){if(b||!y.isFunction(e))return y.inspect(e);var t=s(e);return"[Function"+(t?": "+t:"")+"]"}function f(e,t,n,r,i){throw new x.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:i})}function l(e,t){e||f(e,!0,t,"==",x.ok)}function p(e,t,n,s){if(e===t)return!0;if(i(e)&&i(t))return 0===r(e,t);if(y.isDate(e)&&y.isDate(t))return e.getTime()===t.getTime();if(y.isRegExp(e)&&y.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(a(e)&&a(t)&&o(e)===o(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===r(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(i(e)!==i(t))return!1;var u=(s=s||{actual:[],expected:[]}).actual.indexOf(e);return-1!==u&&u===s.expected.indexOf(t)||(s.actual.push(e),s.expected.push(t),function(e,t,n,r){if(null==e||null==t)return!1;if(y.isPrimitive(e)||y.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=h(e),o=h(t);if(i&&!o||!i&&o)return!1;if(i)return p(e=v.call(e),t=v.call(t),n);var a,s,u=_(e),c=_(t);if(u.length!==c.length)return!1;for(u.sort(),c.sort(),s=u.length-1;s>=0;s--)if(u[s]!==c[s])return!1;for(s=u.length-1;s>=0;s--)if(!p(e[a=u[s]],t[a],n,r))return!1;return!0}(e,t,n,s))}return n?e===t:e==t}function h(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function m(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function d(e,t,n,r){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),e&&!i&&f(i,n,"Missing expected exception"+r);var o="string"==typeof r,a=!e&&i&&!n;if((!e&&y.isError(i)&&o&&m(i,n)||a)&&f(i,n,"Got unwanted exception"+r),e&&i&&n&&!m(i,n)||!e&&i)throw i}var y=n(33),g=Object.prototype.hasOwnProperty,v=Array.prototype.slice,b="foo"===function(){}.name,x=e.exports=l,w=/\s*function\s+([^\(\s]*)\s*/;x.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return u(c(e.actual),128)+" "+e.operator+" "+u(c(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||f;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var r=n.stack,i=s(t),o=r.indexOf("\n"+i);if(o>=0){var a=r.indexOf("\n",o+1);r=r.substring(a+1)}this.stack=r}}},y.inherits(x.AssertionError,Error),x.fail=f,x.ok=l,x.equal=function(e,t,n){e!=t&&f(e,t,n,"==",x.equal)},x.notEqual=function(e,t,n){e==t&&f(e,t,n,"!=",x.notEqual)},x.deepEqual=function(e,t,n){p(e,t,!1)||f(e,t,n,"deepEqual",x.deepEqual)},x.deepStrictEqual=function(e,t,n){p(e,t,!0)||f(e,t,n,"deepStrictEqual",x.deepStrictEqual)},x.notDeepEqual=function(e,t,n){p(e,t,!1)&&f(e,t,n,"notDeepEqual",x.notDeepEqual)},x.notDeepStrictEqual=function e(t,n,r){p(t,n,!0)&&f(t,n,r,"notDeepStrictEqual",e)},x.strictEqual=function(e,t,n){e!==t&&f(e,t,n,"===",x.strictEqual)},x.notStrictEqual=function(e,t,n){e===t&&f(e,t,n,"!==",x.notStrictEqual)},x.throws=function(e,t,n){d(!0,e,t,n)},x.doesNotThrow=function(e,t,n){d(!1,e,t,n)},x.ifError=function(e){if(e)throw e};var _=Object.keys||function(e){var t=[];for(var n in e)g.call(e,n)&&t.push(n);return t}}).call(t,n(5))},function(e,t,n){"use strict";var r=(n(0),"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e});t.a=function(e){if("object"!==r(e.ampSpectrum))throw new TypeError("Valid ampSpectrum is required to generate chroma");if("object"!==r(e.chromaFilterBank))throw new TypeError("Valid chromaFilterBank is required to generate chroma");var t=e.chromaFilterBank.map((function(t,n){return e.ampSpectrum.reduce((function(e,n,r){return e+n*t[r]}),0)})),n=Math.max.apply(Math,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t));return n?t.map((function(e){return e/n})):t}},function(e,t,n){"use strict";var r=n(7),i=(n.n(r),"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e});t.a=function(){if("object"!==i(arguments[0].signal))throw new TypeError;for(var e=0,t=0;t<arguments[0].signal.length;t++)e+=Math.pow(Math.abs(arguments[0].signal[t]),2);return e}},function(e,t,n){"use strict";var r=n(3),i=(n(0),"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}),o=n(26);t.a=function(e){if("object"!==i(e.ampSpectrum))throw new TypeError("Valid ampSpectrum is required to generate MFCC");if("object"!==i(e.melFilterBank))throw new TypeError("Valid melFilterBank is required to generate MFCC");for(var t=n.i(r.a)(e),a=e.melFilterBank.length,s=Array(a),u=new Float32Array(a),c=0;c<u.length;c++){s[c]=new Float32Array(e.bufferSize/2),u[c]=0;for(var f=0;f<e.bufferSize/2;f++)s[c][f]=e.melFilterBank[c][f]*t[f],u[c]+=s[c][f];u[c]=Math.log(u[c]+1)}var l=Array.prototype.slice.call(u);return o(l).slice(0,13)}},function(e,t,n){"use strict";var r=n(2),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.a=function(){if("object"!==i(arguments[0].signal))throw new TypeError;for(var e=n.i(r.a)(arguments[0]),t=e.specific,o=0,a=0;a<t.length;a++)o+=a<15?(a+1)*t[a+1]:.066*Math.exp(.171*(a+1));return o*(.11/e.total)}},function(e,t,n){"use strict";var r=n(2),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.a=function(){if("object"!==i(arguments[0].signal))throw new TypeError;for(var e=n.i(r.a)(arguments[0]),t=0,o=0;o<e.specific.length;o++)e.specific[o]>t&&(t=e.specific[o]);return Math.pow((e.total-t)/e.total,2)}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.a=function(e){if("object"!==r(e.signal))throw new TypeError;for(var t=0,n=0;n<e.signal.length;n++)t+=Math.pow(e.signal[n],2);return t/=e.signal.length,Math.sqrt(t)}},function(e,t,n){"use strict";var r=n(1),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.a=function(){if("object"!==i(arguments[0].ampSpectrum))throw new TypeError;return n.i(r.a)(1,arguments[0].ampSpectrum)}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.a=function(){if("object"!==r(arguments[0].ampSpectrum))throw new TypeError;for(var e=0,t=0,n=0;n<arguments[0].ampSpectrum.length;n++)e+=Math.log(arguments[0].ampSpectrum[n]),t+=arguments[0].ampSpectrum[n];return Math.exp(e/arguments[0].ampSpectrum.length)*arguments[0].ampSpectrum.length/t}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.a=function(e){if("object"!==r(e.signal)||"object"!=r(e.previousSignal))throw new TypeError;for(var t=0,n=-e.bufferSize/2;n<signal.length/2-1;n++)x=Math.abs(e.signal[n])-Math.abs(e.previousSignal[n]),t+=(x+Math.abs(x))/2;return t}},function(e,t,n){"use strict";var r=n(1),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.a=function(){if("object"!==i(arguments[0].ampSpectrum))throw new TypeError;var e=arguments[0].ampSpectrum,t=n.i(r.a)(1,e),o=n.i(r.a)(2,e),a=n.i(r.a)(3,e),s=n.i(r.a)(4,e);return(-3*Math.pow(t,4)+6*t*o-4*t*a+s)/Math.pow(Math.sqrt(o-Math.pow(t,2)),4)}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.a=function(){if("object"!==r(arguments[0].ampSpectrum))throw new TypeError;for(var e=arguments[0].ampSpectrum,t=arguments[0].sampleRate/(2*(e.length-1)),n=0,i=0;i<e.length;i++)n+=e[i];for(var o=.99*n,a=e.length-1;n>o&&a>=0;)n-=e[a],--a;return(a+1)*t}},function(e,t,n){"use strict";var r=n(1),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.a=function(e){if("object"!==i(e.ampSpectrum))throw new TypeError;var t=n.i(r.a)(1,e.ampSpectrum),o=n.i(r.a)(2,e.ampSpectrum),a=n.i(r.a)(3,e.ampSpectrum);return(2*Math.pow(t,3)-3*t*o+a)/Math.pow(Math.sqrt(o-Math.pow(t,2)),3)}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.a=function(e){if("object"!==r(e.ampSpectrum))throw new TypeError;for(var t=0,n=0,i=new Float32Array(e.ampSpectrum.length),o=0,a=0,s=0;s<e.ampSpectrum.length;s++){t+=e.ampSpectrum[s];var u=s*e.sampleRate/e.bufferSize;i[s]=u,o+=u*u,n+=u,a+=u*e.ampSpectrum[s]}return(e.ampSpectrum.length*a-n*t)/(t*(o-Math.pow(n,2)))}},function(e,t,n){"use strict";var r=n(1),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.a=function(e){if("object"!==i(e.ampSpectrum))throw new TypeError;return Math.sqrt(n.i(r.a)(2,e.ampSpectrum)-Math.pow(n.i(r.a)(1,e.ampSpectrum),2))}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.a=function(){if("object"!==r(arguments[0].signal))throw new TypeError;for(var e=0,t=0;t<arguments[0].signal.length;t++)(arguments[0].signal[t]>=0&&arguments[0].signal[t+1]<0||arguments[0].signal[t]<0&&arguments[0].signal[t+1]>=0)&&e++;return e}},function(e,t,n){e.exports=n(6).default},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(0),i=n(4),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n){var o=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m=n,!t.audioContext)throw this._m.errors.noAC;if(t.bufferSize&&!r.b(t.bufferSize))throw this._m._errors.notPow2;if(!t.source)throw this._m._errors.noSource;this._m.audioContext=t.audioContext,this._m.bufferSize=t.bufferSize||this._m.bufferSize||256,this._m.hopSize=t.hopSize||this._m.hopSize||this._m.bufferSize,this._m.sampleRate=t.sampleRate||this._m.audioContext.sampleRate||44100,this._m.callback=t.callback,this._m.windowingFunction=t.windowingFunction||"hanning",this._m.featureExtractors=i,this._m.EXTRACTION_STARTED=t.startImmediately||!1,this._m.spn=this._m.audioContext.createScriptProcessor(this._m.bufferSize,1,1),this._m.spn.connect(this._m.audioContext.destination),this._m._featuresToExtract=t.featureExtractors||[],this._m.barkScale=r.c(this._m.bufferSize,this._m.sampleRate,this._m.bufferSize),this._m.melFilterBank=r.d(this._m.melBands,this._m.sampleRate,this._m.bufferSize),this._m.inputData=null,this._m.previousInputData=null,this._m.frame=null,this._m.previousFrame=null,this.setSource(t.source),this._m.spn.onaudioprocess=function(e){if(null!==o._m.inputData&&(o._m.previousInputData=o._m.inputData),o._m.inputData=e.inputBuffer.getChannelData(0),o._m.previousInputData)(t=new Float32Array(o._m.previousInputData.length+o._m.inputData.length-o._m.hopSize)).set(o._m.previousInputData.slice(o._m.hopSize)),t.set(o._m.inputData,o._m.previousInputData.length-o._m.hopSize);else var t=o._m.inputData;r.g(t,o._m.bufferSize,o._m.hopSize).forEach((function(e){o._m.frame=e;var t=o._m.extract(o._m._featuresToExtract,o._m.frame,o._m.previousFrame);"function"==typeof o._m.callback&&o._m.EXTRACTION_STARTED&&o._m.callback(t),o._m.previousFrame=o._m.frame}))}}return o(e,[{key:"start",value:function(e){this._m._featuresToExtract=e||this._m._featuresToExtract,this._m.EXTRACTION_STARTED=!0}},{key:"stop",value:function(){this._m.EXTRACTION_STARTED=!1}},{key:"setSource",value:function(e){e.connect(this._m.spn)}},{key:"get",value:function(e){return this._m.inputData?this._m.extract(e||this._m._featuresToExtract,this._m.inputData,this._m.previousInputData):null}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.blackman=function(e){for(var t=new Float32Array(e),n=2*Math.PI/(e-1),r=2*n,i=0;i<e/2;i++)t[i]=.42-.5*Math.cos(i*n)+.08*Math.cos(i*r);for(var o=e/2;o>0;o--)t[e-o]=t[o-1];return t},t.sine=function(e){for(var t=Math.PI/(e-1),n=new Float32Array(e),r=0;r<e;r++)n[r]=Math.sin(t*r);return n},t.hanning=function(e){for(var t=new Float32Array(e),n=0;n<e;n++)t[n]=.5-.5*Math.cos(2*Math.PI*n/(e-1));return t},t.hamming=function(e){for(var t=new Float32Array(e),n=0;n<e;n++)t[n]=.54-.46*Math.cos(2*Math.PI*(n/e-1));return t}},function(e,t,n){e.exports=n(27)},function(e,t){cosMap=null;e.exports=function(e,t){var n=e.length;return t=t||2,cosMap&&cosMap[n]||function(e){cosMap=cosMap||{},cosMap[e]=new Array(e*e);for(var t=Math.PI/e,n=0;n<e;n++)for(var r=0;r<e;r++)cosMap[e][r+n*e]=Math.cos(t*(r+.5)*n)}(n),e.map((function(){return 0})).map((function(r,i){return t*e.reduce((function(e,t,r,o){return e+t*cosMap[n][r+i*n]}),0)}))}},function(e,t,n){"use strict";var r=n(29),i=function(e){var t={};void 0===e.real||void 0===e.imag?t=r.constructComplexArray(e):(t.real=e.real.slice(),t.imag=e.imag.slice());var n=t.real.length,i=Math.log2(n);if(Math.round(i)!=i)throw new Error("Input size must be a power of 2.");if(t.real.length!=t.imag.length)throw new Error("Real and imaginary components must have the same length.");for(var o=r.bitReverseArray(n),a={real:[],imag:[]},s=0;s<n;s++)a.real[o[s]]=t.real[s],a.imag[o[s]]=t.imag[s];for(var u=0;u<n;u++)t.real[u]=a.real[u],t.imag[u]=a.imag[u];for(var c=1;c<=i;c++)for(var f=Math.pow(2,c),l=0;l<f/2;l++)for(var p=r.euler(l,f),h=0;h<n/f;h++){var m=f*h+l,d=f*h+l+f/2,y={real:t.real[m],imag:t.imag[m]},g={real:t.real[d],imag:t.imag[d]},v=r.multiply(p,g),b=r.subtract(y,v);t.real[d]=b.real,t.imag[d]=b.imag;var x=r.add(v,y);t.real[m]=x.real,t.imag[m]=x.imag}return t};e.exports={fft:i,ifft:function(e){if(void 0===e.real||void 0===e.imag)throw new Error("IFFT only accepts a complex input.");for(var t=e.real.length,n={real:[],imag:[]},o=0;o<t;o++){var a={real:e.real[o],imag:e.imag[o]},s=r.conj(a);n.real[o]=s.real,n.imag[o]=s.imag}var u=i(n);return n.real=u.real.map((function(e){return e/t})),n.imag=u.imag.map((function(e){return e/t})),n}}},function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var i={},o={};e.exports={bitReverseArray:function(e){if(void 0===i[e]){for(var t=(e-1).toString(2).length,n="0".repeat(t),o={},a=0;a<e;a++){var s=a.toString(2);s=n.substr(s.length)+s,s=[].concat(r(s)).reverse().join(""),o[a]=parseInt(s,2)}i[e]=o}return i[e]},multiply:function(e,t){return{real:e.real*t.real-e.imag*t.imag,imag:e.real*t.imag+e.imag*t.real}},add:function(e,t){return{real:e.real+t.real,imag:e.imag+t.imag}},subtract:function(e,t){return{real:e.real-t.real,imag:e.imag-t.imag}},euler:function(e,t){var n=-2*Math.PI*e/t;return{real:Math.cos(n),imag:Math.sin(n)}},conj:function(e){return e.imag*=-1,e},constructComplexArray:function(e){var t={};t.real=void 0===e.real?e.slice():e.real.slice();var n=t.real.length;return void 0===o[n]&&(o[n]=Array.apply(null,Array(n)).map(Number.prototype.valueOf,0)),t.imag=o[n].slice(),t}}},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(c===setTimeout)return setTimeout(e,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function o(){m&&p&&(m=!1,p.length?h=p.concat(h):d=-1,h.length&&a())}function a(){if(!m){var e=i(o);m=!0;for(var t=h.length;t;){for(p=h,h=[];++d<t;)p&&p[d].run();d=-1,t=h.length}p=null,m=!1,function(e){if(f===clearTimeout)return clearTimeout(e);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}(e)}}function s(e,t){this.fun=e,this.array=t}function u(){}var c,f,l=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(e){c=n}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(e){f=r}}();var p,h=[],m=!1,d=-1;l.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new s(e,t)),1!==h.length||m||i(a)},s.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=u,l.addListener=u,l.once=u,l.off=u,l.removeListener=u,l.removeAllListeners=u,l.emit=u,l.prependListener=u,l.prependOnceListener=u,l.listeners=function(e){return[]},l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t,n){(function(e,r){function i(e,n){var r={seen:[],stylize:a};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(n)?r.showHidden=n:n&&t._extend(r,n),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=o),s(r,e,r.depth)}function o(e,t){var n=i.styles[t];return n?"["+i.colors[n][0]+"m"+e+"["+i.colors[n][1]+"m":e}function a(e,t){return e}function s(e,n,r){if(e.customInspect&&n&&w(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return d(i)||(i=s(e,i,r)),i}var o=u(e,n);if(o)return o;var a=Object.keys(n),p=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(n)),x(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return c(n);if(0===a.length){if(w(n)){var h=n.name?": "+n.name:"";return e.stylize("[Function"+h+"]","special")}if(g(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(b(n))return e.stylize(Date.prototype.toString.call(n),"date");if(x(n))return c(n)}var m,y="",v=!1,_=["{","}"];return l(n)&&(v=!0,_=["[","]"]),w(n)&&(y=" [Function"+(n.name?": "+n.name:"")+"]"),g(n)&&(y=" "+RegExp.prototype.toString.call(n)),b(n)&&(y=" "+Date.prototype.toUTCString.call(n)),x(n)&&(y=" "+c(n)),0!==a.length||v&&0!=n.length?r<0?g(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),m=v?function(e,t,n,r,i){for(var o=[],a=0,s=t.length;a<s;++a)A(t,String(a))?o.push(f(e,t,n,r,String(a),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(f(e,t,n,r,i,!0))})),o}(e,n,r,p,a):a.map((function(t){return f(e,n,r,p,t,v)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(m,y,_)):_[0]+y+_[1]}function u(e,t){if(y(t))return e.stylize("undefined","undefined");if(d(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return m(t)?e.stylize(""+t,"number"):p(t)?e.stylize(""+t,"boolean"):h(t)?e.stylize("null","null"):void 0}function c(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,i,o){var a,u,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?u=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(u=e.stylize("[Setter]","special")),A(r,i)||(a="["+i+"]"),u||(e.seen.indexOf(c.value)<0?(u=h(n)?s(e,c.value,null):s(e,c.value,n-1)).indexOf("\n")>-1&&(u=o?u.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+u.split("\n").map((function(e){return"   "+e})).join("\n")):u=e.stylize("[Circular]","special")),y(a)){if(o&&i.match(/^\d+$/))return u;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+u}function l(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function h(e){return null===e}function m(e){return"number"==typeof e}function d(e){return"string"==typeof e}function y(e){return void 0===e}function g(e){return v(e)&&"[object RegExp]"===_(e)}function v(e){return"object"==typeof e&&null!==e}function b(e){return v(e)&&"[object Date]"===_(e)}function x(e){return v(e)&&("[object Error]"===_(e)||e instanceof Error)}function w(e){return"function"==typeof e}function _(e){return Object.prototype.toString.call(e)}function S(e){return e<10?"0"+e.toString(10):e.toString(10)}function E(){var e=new Date,t=[S(e.getHours()),S(e.getMinutes()),S(e.getSeconds())].join(":");return[e.getDate(),C[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var k=/%[sdj%]/g;t.format=function(e){if(!d(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(i(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,a=String(e).replace(k,(function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),s=r[n];n<o;s=r[++n])h(s)||!v(s)?a+=" "+s:a+=" "+i(s);return a},t.deprecate=function(n,i){if(y(e.process))return function(){return t.deprecate(n,i).apply(this,arguments)};if(!0===r.noDeprecation)return n;var o=!1;return function(){if(!o){if(r.throwDeprecation)throw new Error(i);r.traceDeprecation?console.trace(i):console.error(i),o=!0}return n.apply(this,arguments)}};var T,j={};t.debuglog=function(e){if(y(T)&&(T=r.env.NODE_DEBUG||""),e=e.toUpperCase(),!j[e])if(new RegExp("\\b"+e+"\\b","i").test(T)){var n=r.pid;j[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,r)}}else j[e]=function(){};return j[e]},t.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=l,t.isBoolean=p,t.isNull=h,t.isNullOrUndefined=function(e){return null==e},t.isNumber=m,t.isString=d,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=y,t.isRegExp=g,t.isObject=v,t.isDate=b,t.isError=x,t.isFunction=w,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(32);var C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];t.log=function(){console.log("%s - %s",E(),t.format.apply(t,arguments))},t.inherits=n(31),t._extend=function(e,t){if(!t||!v(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(t,n(5),n(30))}])},"object"==typeof n&&"object"==typeof t?t.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof n?n.Meyda=r():this.Meyda=r()},{}],6:[function(e,t,n){(function(e){(function(){var n,r,i,o,a,s;"undefined"!=typeof performance&&null!==performance&&performance.now?t.exports=function(){return performance.now()}:null!=e&&e.hrtime?(t.exports=function(){return(n()-a)/1e6},r=e.hrtime,o=(n=function(){var e;return 1e9*(e=r())[0]+e[1]})(),s=1e9*e.uptime(),a=o-s):Date.now?(t.exports=function(){return Date.now()-i},i=Date.now()):(t.exports=function(){return(new Date).getTime()-i},i=(new Date).getTime())}).call(this)}).call(this,e("_process"))},{_process:2}],7:[function(e,t,n){var r=e("inherits"),i=e("events").EventEmitter,o=e("right-now"),a=e("raf");function s(e){if(!(this instanceof s))return new s(e);this.running=!1,this.last=o(),this._frame=0,this._tick=this.tick.bind(this),e&&this.on("tick",e)}t.exports=s,r(s,i),s.prototype.start=function(){if(!this.running)return this.running=!0,this.last=o(),this._frame=a(this._tick),this},s.prototype.stop=function(){return this.running=!1,0!==this._frame&&a.cancel(this._frame),this._frame=0,this},s.prototype.tick=function(){this._frame=a(this._tick);var e=o(),t=e-this.last;this.emit("tick",t),this.last=e}},{events:1,inherits:4,raf:8,"right-now":10}],8:[function(e,t,n){(function(n){for(var r=e("performance-now"),i="undefined"==typeof window?n:window,o=["moz","webkit"],a="AnimationFrame",s=i["request"+a],u=i["cancel"+a]||i["cancelRequest"+a],c=0;!s&&c<o.length;c++)s=i[o[c]+"Request"+a],u=i[o[c]+"Cancel"+a]||i[o[c]+"CancelRequest"+a];if(!s||!u){var f=0,l=0,p=[];s=function(e){if(0===p.length){var t=r(),n=Math.max(0,16.666666666666668-(t-f));f=n+t,setTimeout((function(){var e=p.slice(0);p.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(f)}catch(e){setTimeout((function(){throw e}),0)}}),Math.round(n))}return p.push({handle:++l,callback:e,cancelled:!1}),l},u=function(e){for(var t=0;t<p.length;t++)p[t].handle===e&&(p[t].cancelled=!0)}}t.exports=function(e){return s.call(i,e)},t.exports.cancel=function(){u.apply(i,arguments)},t.exports.polyfill=function(e){e||(e=i),e.requestAnimationFrame=s,e.cancelAnimationFrame=u}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"performance-now":6}],9:[function(e,t,n){var r;r=function(){function e(e,t){this.id=$++,this.type=e,this.data=t}function t(e){if(0===e.length)return[];var n=e.charAt(0),r=e.charAt(e.length-1);if(1<e.length&&n===r&&('"'===n||"'"===n))return['"'+e.substr(1,e.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(n=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e))return t(e.substr(0,n.index)).concat(t(n[1])).concat(t(e.substr(n.index+n[0].length)));if(1===(n=e.split(".")).length)return['"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];for(e=[],r=0;r<n.length;++r)e=e.concat(t(n[r]));return e}function n(e){return"["+t(e).join("][")+"]"}function r(e){return"string"==typeof e?e.split():e}function i(e){return"string"==typeof e?document.querySelector(e):e}function o(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}function a(e){var t,n;return t=(65535<e)<<4,t|=n=(255<(e>>>=t))<<3,(t|=n=(15<(e>>>=n))<<2)|(n=(3<(e>>>=n))<<1)|e>>>n>>1}function s(){function e(e){e:{for(var t=16;268435456>=t;t*=16)if(e<=t){e=t;break e}e=0}return 0<(t=n[a(e)>>2]).length?t.pop():new ArrayBuffer(e)}function t(e){n[a(e.byteLength)>>2].push(e)}var n=o(8,(function(){return[]}));return{alloc:e,free:t,allocType:function(t,n){var r=null;switch(t){case 5120:r=new Int8Array(e(n),0,n);break;case 5121:r=new Uint8Array(e(n),0,n);break;case 5122:r=new Int16Array(e(2*n),0,n);break;case 5123:r=new Uint16Array(e(2*n),0,n);break;case 5124:r=new Int32Array(e(4*n),0,n);break;case 5125:r=new Uint32Array(e(4*n),0,n);break;case 5126:r=new Float32Array(e(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){t(e.buffer)}}}function u(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||Q(e.data))}function c(e,t,n,r,i,o){for(var a=0;a<t;++a)for(var s=e[a],u=0;u<n;++u)for(var c=s[u],f=0;f<r;++f)i[o++]=c[f]}function f(e,t,n,r,i){for(var o=1,a=n+1;a<t.length;++a)o*=t[a];var s=t[n];if(4==t.length-n){var u=t[n+1],l=t[n+2];for(t=t[n+3],a=0;a<s;++a)c(e[a],u,l,t,r,i),i+=o}else for(a=0;a<s;++a)f(e[a],t,n+1,r,i),i+=o}function l(e){return 0|K[Object.prototype.toString.call(e)]}function p(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function h(e,t,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var c=0;c<r;++c)e[s++]=t[i*u+o*c+a]}function m(e,t,n,r){function i(t){this.id=c++,this.buffer=e.createBuffer(),this.type=t,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,n.profile&&(this.stats={size:0})}function o(t,n,r){t.byteLength=n.byteLength,e.bufferData(t.type,n,r)}function a(e,t,n,r,i,a){if(e.usage=n,Array.isArray(t)){if(e.dtype=r||5126,0<t.length)if(Array.isArray(t[0])){i=te(t);for(var s=r=1;s<i.length;++s)r*=i[s];e.dimension=r,o(e,t=ee(t,i,e.dtype),n),a?e.persistentData=t:X.freeType(t)}else"number"==typeof t[0]?(e.dimension=i,p(i=X.allocType(e.dtype,t.length),t),o(e,i,n),a?e.persistentData=i:X.freeType(i)):Q(t[0])&&(e.dimension=t[0].length,e.dtype=r||l(t[0])||5126,o(e,t=ee(t,[t.length,t[0].length],e.dtype),n),a?e.persistentData=t:X.freeType(t))}else if(Q(t))e.dtype=r||l(t),e.dimension=i,o(e,t,n),a&&(e.persistentData=new Uint8Array(new Uint8Array(t.buffer)));else if(u(t)){i=t.shape;var c=t.stride,f=(s=t.offset,0),m=0,d=0,y=0;1===i.length?(f=i[0],m=1,d=c[0],y=0):2===i.length&&(f=i[0],m=i[1],d=c[0],y=c[1]),e.dtype=r||l(t.data)||5126,e.dimension=m,h(i=X.allocType(e.dtype,f*m),t.data,f,m,d,y,s),o(e,i,n),a?e.persistentData=i:X.freeType(i)}}function s(n){t.bufferCount--;for(var i=0;i<r.state.length;++i){var o=r.state[i];o.buffer===n&&(e.disableVertexAttribArray(i),o.buffer=null)}e.deleteBuffer(n.buffer),n.buffer=null,delete f[n.id]}var c=0,f={};i.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},i.prototype.destroy=function(){s(this)};var m=[];return n.profile&&(t.getTotalBufferSize=function(){var e=0;return Object.keys(f).forEach((function(t){e+=f[t].stats.size})),e}),{create:function(r,o,c,m){function d(t){var r=35044,i=null,o=0,s=0,c=1;return Array.isArray(t)||Q(t)||u(t)?i=t:"number"==typeof t?o=0|t:t&&("data"in t&&(i=t.data),"usage"in t&&(r=Z[t.usage]),"type"in t&&(s=J[t.type]),"dimension"in t&&(c=0|t.dimension),"length"in t&&(o=0|t.length)),y.bind(),i?a(y,i,r,s,c,m):(o&&e.bufferData(y.type,o,r),y.dtype=s||5121,y.usage=r,y.dimension=c,y.byteLength=o),n.profile&&(y.stats.size=y.byteLength*ne[y.dtype]),d}t.bufferCount++;var y=new i(o);return f[y.id]=y,c||d(r),d._reglType="buffer",d._buffer=y,d.subdata=function(t,n){var r,i=0|(n||0);if(y.bind(),Q(t))e.bufferSubData(y.type,i,t);else if(Array.isArray(t)){if(0<t.length)if("number"==typeof t[0]){var o=X.allocType(y.dtype,t.length);p(o,t),e.bufferSubData(y.type,i,o),X.freeType(o)}else(Array.isArray(t[0])||Q(t[0]))&&(r=te(t),o=ee(t,r,y.dtype),e.bufferSubData(y.type,i,o),X.freeType(o))}else if(u(t)){r=t.shape;var a=t.stride,s=o=0,c=0,f=0;1===r.length?(o=r[0],s=1,c=a[0],f=0):2===r.length&&(o=r[0],s=r[1],c=a[0],f=a[1]),r=Array.isArray(t.data)?y.dtype:l(t.data),h(r=X.allocType(r,o*s),t.data,o,s,c,f,t.offset),e.bufferSubData(y.type,i,r),X.freeType(r)}return d},n.profile&&(d.stats=y.stats),d.destroy=function(){s(y)},d},createStream:function(e,t){var n=m.pop();return n||(n=new i(e)),n.bind(),a(n,t,35040,0,1,!1),n},destroyStream:function(e){m.push(e)},clear:function(){G(f).forEach(s),m.forEach(s)},getBuffer:function(e){return e&&e._buffer instanceof i?e._buffer:null},restore:function(){G(f).forEach((function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)}))},_initBuffer:a}}function d(e,t,n,r){function i(e){this.id=c++,s[this.id]=this,this.buffer=e,this.primType=4,this.type=this.vertCount=0}function o(r,i,o,a,s,c,f){if(r.buffer.bind(),i){var l=f;f||Q(i)&&(!u(i)||Q(i.data))||(l=t.oes_element_index_uint?5125:5123),n._initBuffer(r.buffer,i,o,l,3)}else e.bufferData(34963,c,o),r.buffer.dtype=l||5121,r.buffer.usage=o,r.buffer.dimension=3,r.buffer.byteLength=c;if(l=f,!f){switch(r.buffer.dtype){case 5121:case 5120:l=5121;break;case 5123:case 5122:l=5123;break;case 5125:case 5124:l=5125}r.buffer.dtype=l}r.type=l,0>(i=s)&&(i=r.buffer.byteLength,5123===l?i>>=1:5125===l&&(i>>=2)),r.vertCount=i,i=a,0>a&&(i=4,1===(a=r.buffer.dimension)&&(i=0),2===a&&(i=1),3===a&&(i=4)),r.primType=i}function a(e){r.elementsCount--,delete s[e.id],e.buffer.destroy(),e.buffer=null}var s={},c=0,f={uint8:5121,uint16:5123};t.oes_element_index_uint&&(f.uint32=5125),i.prototype.bind=function(){this.buffer.bind()};var l=[];return{create:function(e,t){function s(e){if(e)if("number"==typeof e)c(e),l.primType=4,l.vertCount=0|e,l.type=5121;else{var t=null,n=35044,r=-1,i=-1,a=0,p=0;Array.isArray(e)||Q(e)||u(e)?t=e:("data"in e&&(t=e.data),"usage"in e&&(n=Z[e.usage]),"primitive"in e&&(r=re[e.primitive]),"count"in e&&(i=0|e.count),"type"in e&&(p=f[e.type]),"length"in e?a=0|e.length:(a=i,5123===p||5122===p?a*=2:5125!==p&&5124!==p||(a*=4))),o(l,t,n,r,i,a,p)}else c(),l.primType=4,l.vertCount=0,l.type=5121;return s}var c=n.create(null,34963,!0),l=new i(c._buffer);return r.elementsCount++,s(e),s._reglType="elements",s._elements=l,s.subdata=function(e,t){return c.subdata(e,t),s},s.destroy=function(){a(l)},s},createStream:function(e){var t=l.pop();return t||(t=new i(n.create(null,34963,!0,!1)._buffer)),o(t,e,35040,-1,-1,0,0),t},destroyStream:function(e){l.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof i?e._elements:null},clear:function(){G(s).forEach(a)}}}function y(e){for(var t=X.allocType(5123,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(1/0===e[n])t[n]=31744;else if(-1/0===e[n])t[n]=64512;else{ie[0]=e[n];var r=(o=oe[0])>>>31<<15,i=(o<<1>>>24)-127,o=o>>13&1023;t[n]=-24>i?r:-14>i?r+(o+1024>>-14-i):15<i?r+31744:r+(i+15<<10)+o}return t}function g(e){return Array.isArray(e)||Q(e)}function v(e){return"[object "+e+"]"}function b(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function x(e){return!(!Array.isArray(e)||0===e.length||!g(e[0]))}function w(e){return Object.prototype.toString.call(e)}function _(e){if(!e)return!1;var t=w(e);return 0<=me.indexOf(t)||b(e)||x(e)||u(e)}function S(e,t){36193===e.type?(e.data=y(t),X.freeType(t)):e.data=t}function E(e,t,n,r,i,o){if(e=void 0!==ye[e]?ye[e]:ue[e]*de[t],o&&(e*=6),i){for(r=0;1<=n;)r+=e*n*n,n/=2;return r}return e*n*r}function A(e,t,n,r,i,o,a){function s(){this.format=this.internalformat=6408,this.type=5121,this.flipY=this.premultiplyAlpha=this.compressed=!1,this.unpackAlignment=1,this.colorSpace=37444,this.channels=this.height=this.width=0}function c(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function f(e,t){if("object"==typeof t&&t){"premultiplyAlpha"in t&&(e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(e.flipY=t.flipY),"alignment"in t&&(e.unpackAlignment=t.alignment),"colorSpace"in t&&(e.colorSpace=N[t.colorSpace]),"type"in t&&(e.type=H[t.type]);var n=e.width,r=e.height,i=e.channels,o=!1;"shape"in t?(n=t.shape[0],r=t.shape[1],3===t.shape.length&&(i=t.shape[2],o=!0)):("radius"in t&&(n=r=t.radius),"width"in t&&(n=t.width),"height"in t&&(r=t.height),"channels"in t&&(i=t.channels,o=!0)),e.width=0|n,e.height=0|r,e.channels=0|i,n=!1,"format"in t&&(n=t.format,r=e.internalformat=W[n],e.format=oe[r],n in H&&!("type"in t)&&(e.type=H[n]),n in Y&&(e.compressed=!0),n=!0),!o&&n?e.channels=ue[e.format]:o&&!n&&e.channels!==se[e.format]&&(e.format=e.internalformat=se[e.channels])}}function l(t){e.pixelStorei(37440,t.flipY),e.pixelStorei(37441,t.premultiplyAlpha),e.pixelStorei(37443,t.colorSpace),e.pixelStorei(3317,t.unpackAlignment)}function p(){s.call(this),this.yOffset=this.xOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function h(e,t){var n=null;if(_(t)?n=t:t&&(f(e,t),"x"in t&&(e.xOffset=0|t.x),"y"in t&&(e.yOffset=0|t.y),_(t.data)&&(n=t.data)),t.copy){var r=i.viewportWidth,o=i.viewportHeight;e.width=e.width||r-e.xOffset,e.height=e.height||o-e.yOffset,e.needsCopy=!0}else if(n){if(Q(n))e.channels=e.channels||4,e.data=n,"type"in t||5121!==e.type||(e.type=0|K[Object.prototype.toString.call(n)]);else if(b(n)){switch(e.channels=e.channels||4,o=(r=n).length,e.type){case 5121:case 5123:case 5125:case 5126:(o=X.allocType(e.type,o)).set(r),e.data=o;break;case 36193:e.data=y(r)}e.alignment=1,e.needsFree=!0}else if(u(n)){r=n.data,Array.isArray(r)||5121!==e.type||(e.type=0|K[Object.prototype.toString.call(r)]),o=n.shape;var a,s,c,l,p=n.stride;3===o.length?(c=o[2],l=p[2]):l=c=1,a=o[0],s=o[1],o=p[0],p=p[1],e.alignment=1,e.width=a,e.height=s,e.channels=c,e.format=e.internalformat=se[c],e.needsFree=!0,a=l,n=n.offset,c=e.width,l=e.height,s=e.channels;for(var h=X.allocType(36193===e.type?5126:e.type,c*l*s),m=0,d=0;d<l;++d)for(var v=0;v<c;++v)for(var E=0;E<s;++E)h[m++]=r[o*v+p*d+a*E+n];S(e,h)}else if(w(n)===ce||w(n)===fe)w(n)===ce?e.element=n:e.element=n.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(w(n)===le)e.element=n,e.width=n.width,e.height=n.height,e.channels=4;else if(w(n)===pe)e.element=n,e.width=n.naturalWidth,e.height=n.naturalHeight,e.channels=4;else if(w(n)===he)e.element=n,e.width=n.videoWidth,e.height=n.videoHeight,e.channels=4;else if(x(n)){for(r=e.width||n[0].length,o=e.height||n.length,p=e.channels,p=g(n[0][0])?p||n[0][0].length:p||1,a=V.shape(n),c=1,l=0;l<a.length;++l)c*=a[l];c=X.allocType(36193===e.type?5126:e.type,c),V.flatten(n,a,"",c),S(e,c),e.alignment=1,e.width=r,e.height=o,e.channels=p,e.format=e.internalformat=se[p],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4}function m(t,n,i,o,a){var s=t.element,u=t.data,c=t.internalformat,f=t.format,p=t.type,h=t.width,m=t.height;l(t),s?e.texSubImage2D(n,a,i,o,f,p,s):t.compressed?e.compressedTexSubImage2D(n,a,i,o,c,h,m,u):t.needsCopy?(r(),e.copyTexSubImage2D(n,a,i,o,t.xOffset,t.yOffset,h,m)):e.texSubImage2D(n,a,i,o,h,m,f,p,u)}function d(){return me.pop()||new p}function v(e){e.needsFree&&X.freeType(e.data),p.call(e),me.push(e)}function A(){s.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function k(e,t,n){var r=e.images[0]=d();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function T(e,t){var n=null;if(_(t))c(n=e.images[0]=d(),e),h(n,t),e.mipmask=1;else if(f(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)c(n=e.images[i]=d(),e),n.width>>=i,n.height>>=i,h(n,r[i]),e.mipmask|=1<<i;else c(n=e.images[0]=d(),e),h(n,t),e.mipmask=1;c(e,e.images[0])}function j(t,n){for(var i=t.images,o=0;o<i.length&&i[o];++o){var a=i[o],s=n,u=o,c=a.element,f=a.data,p=a.internalformat,h=a.format,m=a.type,d=a.width,y=a.height,g=a.channels;l(a),c?e.texImage2D(s,u,h,h,m,c):a.compressed?e.compressedTexImage2D(s,u,p,d,y,0,f):a.needsCopy?(r(),e.copyTexImage2D(s,u,h,a.xOffset,a.yOffset,d,y,0)):((a=!f)&&(f=X.zero.allocType(m,d*y*g)),e.texImage2D(s,u,h,d,y,0,h,m,f),a&&f&&X.zero.freeType(f))}}function C(){var e=de.pop()||new A;s.call(e);for(var t=e.mipmask=0;16>t;++t)e.images[t]=null;return e}function D(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&v(t[n]),t[n]=null;de.push(e)}function O(){this.magFilter=this.minFilter=9728,this.wrapT=this.wrapS=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function F(e,t){"min"in t&&(e.minFilter=$[t.min],0<=ae.indexOf(e.minFilter)&&!("faces"in t)&&(e.genMipmaps=!0)),"mag"in t&&(e.magFilter=q[t.mag]);var n=e.wrapS,r=e.wrapT;if("wrap"in t){var i=t.wrap;"string"==typeof i?n=r=P[i]:Array.isArray(i)&&(n=P[i[0]],r=P[i[1]])}else"wrapS"in t&&(n=P[t.wrapS]),"wrapT"in t&&(r=P[t.wrapT]);if(e.wrapS=n,e.wrapT=r,"anisotropic"in t&&(e.anisotropic=t.anisotropic),"mipmap"in t){switch(n=!1,typeof t.mipmap){case"string":e.mipmapHint=I[t.mipmap],n=e.genMipmaps=!0;break;case"boolean":n=e.genMipmaps=t.mipmap;break;case"object":e.genMipmaps=!1,n=!0}!n||"min"in t||(e.minFilter=9984)}}function M(n,r){e.texParameteri(r,10241,n.minFilter),e.texParameteri(r,10240,n.magFilter),e.texParameteri(r,10242,n.wrapS),e.texParameteri(r,10243,n.wrapT),t.ext_texture_filter_anisotropic&&e.texParameteri(r,34046,n.anisotropic),n.genMipmaps&&(e.hint(33170,n.mipmapHint),e.generateMipmap(r))}function z(t){s.call(this),this.mipmask=0,this.internalformat=6408,this.id=ye++,this.refCount=1,this.target=t,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new O,a.profile&&(this.stats={size:0})}function L(t){e.activeTexture(33984),e.bindTexture(t.target,t.texture)}function B(){var t=be[0];t?e.bindTexture(t.target,t.texture):e.bindTexture(3553,null)}function R(t){var n=t.texture,r=t.unit,i=t.target;0<=r&&(e.activeTexture(33984+r),e.bindTexture(i,null),be[r]=null),e.deleteTexture(n),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete ge[t.id],o.textureCount--}var I={"don't care":4352,"dont care":4352,nice:4354,fast:4353},P={repeat:10497,clamp:33071,mirror:33648},q={nearest:9728,linear:9729},$=U({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},q),N={none:0,browser:37444},H={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},W={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},Y={};t.ext_srgb&&(W.srgb=35904,W.srgba=35906),t.oes_texture_float&&(H.float32=H.float=5126),t.oes_texture_half_float&&(H.float16=H["half float"]=36193),t.webgl_depth_texture&&(U(W,{depth:6402,"depth stencil":34041}),U(H,{uint16:5123,uint32:5125,"depth stencil":34042})),t.webgl_compressed_texture_s3tc&&U(Y,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),t.webgl_compressed_texture_atc&&U(Y,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),t.webgl_compressed_texture_pvrtc&&U(Y,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),t.webgl_compressed_texture_etc1&&(Y["rgb etc1"]=36196);var J=Array.prototype.slice.call(e.getParameter(34467));Object.keys(Y).forEach((function(e){var t=Y[e];0<=J.indexOf(t)&&(W[e]=t)}));var Z=Object.keys(W);n.textureFormats=Z;var ee=[];Object.keys(W).forEach((function(e){ee[W[e]]=e}));var te=[];Object.keys(H).forEach((function(e){te[H[e]]=e}));var ne=[];Object.keys(q).forEach((function(e){ne[q[e]]=e}));var re=[];Object.keys($).forEach((function(e){re[$[e]]=e}));var ie=[];Object.keys(P).forEach((function(e){ie[P[e]]=e}));var oe=Z.reduce((function(e,t){var n=W[t];return 6409===n||6406===n||6409===n||6410===n||6402===n||34041===n?e[n]=n:32855===n||0<=t.indexOf("rgba")?e[n]=6408:e[n]=6407,e}),{}),me=[],de=[],ye=0,ge={},ve=n.maxTextureUnits,be=Array(ve).map((function(){return null}));return U(z.prototype,{bind:function(){this.bindCount+=1;var t=this.unit;if(0>t){for(var n=0;n<ve;++n){var r=be[n];if(r){if(0<r.bindCount)continue;r.unit=-1}be[n]=this,t=n;break}a.profile&&o.maxTextureUnits<t+1&&(o.maxTextureUnits=t+1),this.unit=t,e.activeTexture(33984+t),e.bindTexture(this.target,this.texture)}return t},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&R(this)}}),a.profile&&(o.getTotalTextureSize=function(){var e=0;return Object.keys(ge).forEach((function(t){e+=ge[t].stats.size})),e}),{create2D:function(t,n){function r(e,t){var n=i.texInfo;O.call(n);var o=C();return"number"==typeof e?k(o,0|e,"number"==typeof t?0|t:0|e):e?(F(n,e),T(o,e)):k(o,1,1),n.genMipmaps&&(o.mipmask=(o.width<<1)-1),i.mipmask=o.mipmask,c(i,o),i.internalformat=o.internalformat,r.width=o.width,r.height=o.height,L(i),j(o,3553),M(n,3553),B(),D(o),a.profile&&(i.stats.size=E(i.internalformat,i.type,o.width,o.height,n.genMipmaps,!1)),r.format=ee[i.internalformat],r.type=te[i.type],r.mag=ne[n.magFilter],r.min=re[n.minFilter],r.wrapS=ie[n.wrapS],r.wrapT=ie[n.wrapT],r}var i=new z(3553);return ge[i.id]=i,o.textureCount++,r(t,n),r.subimage=function(e,t,n,o){t|=0,n|=0,o|=0;var a=d();return c(a,i),a.width=0,a.height=0,h(a,e),a.width=a.width||(i.width>>o)-t,a.height=a.height||(i.height>>o)-n,L(i),m(a,3553,t,n,o),B(),v(a),r},r.resize=function(t,n){var o=0|t,s=0|n||o;if(o===i.width&&s===i.height)return r;r.width=i.width=o,r.height=i.height=s,L(i);for(var u,c=i.channels,f=i.type,l=0;i.mipmask>>l;++l){var p=o>>l,h=s>>l;if(!p||!h)break;u=X.zero.allocType(f,p*h*c),e.texImage2D(3553,l,i.format,p,h,0,i.format,i.type,u),u&&X.zero.freeType(u)}return B(),a.profile&&(i.stats.size=E(i.internalformat,i.type,o,s,!1,!1)),r},r._reglType="texture2d",r._texture=i,a.profile&&(r.stats=i.stats),r.destroy=function(){i.decRef()},r},createCube:function(t,n,r,i,s,u){function l(e,t,n,r,i,o){var s,u=p.texInfo;for(O.call(u),s=0;6>s;++s)y[s]=C();if("number"!=typeof e&&e){if("object"==typeof e)if(t)T(y[0],e),T(y[1],t),T(y[2],n),T(y[3],r),T(y[4],i),T(y[5],o);else if(F(u,e),f(p,e),"faces"in e)for(e=e.faces,s=0;6>s;++s)c(y[s],p),T(y[s],e[s]);else for(s=0;6>s;++s)T(y[s],e)}else for(e=0|e||1,s=0;6>s;++s)k(y[s],e,e);for(c(p,y[0]),p.mipmask=u.genMipmaps?(y[0].width<<1)-1:y[0].mipmask,p.internalformat=y[0].internalformat,l.width=y[0].width,l.height=y[0].height,L(p),s=0;6>s;++s)j(y[s],34069+s);for(M(u,34067),B(),a.profile&&(p.stats.size=E(p.internalformat,p.type,l.width,l.height,u.genMipmaps,!0)),l.format=ee[p.internalformat],l.type=te[p.type],l.mag=ne[u.magFilter],l.min=re[u.minFilter],l.wrapS=ie[u.wrapS],l.wrapT=ie[u.wrapT],s=0;6>s;++s)D(y[s]);return l}var p=new z(34067);ge[p.id]=p,o.cubeCount++;var y=Array(6);return l(t,n,r,i,s,u),l.subimage=function(e,t,n,r,i){n|=0,r|=0,i|=0;var o=d();return c(o,p),o.width=0,o.height=0,h(o,t),o.width=o.width||(p.width>>i)-n,o.height=o.height||(p.height>>i)-r,L(p),m(o,34069+e,n,r,i),B(),v(o),l},l.resize=function(t){if((t|=0)!==p.width){l.width=p.width=t,l.height=p.height=t,L(p);for(var n=0;6>n;++n)for(var r=0;p.mipmask>>r;++r)e.texImage2D(34069+n,r,p.format,t>>r,t>>r,0,p.format,p.type,null);return B(),a.profile&&(p.stats.size=E(p.internalformat,p.type,l.width,l.height,!1,!0)),l}},l._reglType="textureCube",l._texture=p,a.profile&&(l.stats=p.stats),l.destroy=function(){p.decRef()},l},clear:function(){for(var t=0;t<ve;++t)e.activeTexture(33984+t),e.bindTexture(3553,null),be[t]=null;G(ge).forEach(R),o.cubeCount=0,o.textureCount=0},getTexture:function(e){return null},restore:function(){for(var t=0;t<ve;++t){var n=be[t];n&&(n.bindCount=0,n.unit=-1,be[t]=null)}G(ge).forEach((function(t){t.texture=e.createTexture(),e.bindTexture(t.target,t.texture);for(var n=0;32>n;++n)if(0!=(t.mipmask&1<<n))if(3553===t.target)e.texImage2D(3553,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null);else for(var r=0;6>r;++r)e.texImage2D(34069+r,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null);M(t.texInfo,t.target)}))}}}function k(e,t,n,r,i,o){function a(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=e=0;t?(e=t.width,r=t.height):n&&(e=n.width,r=n.height),this.width=e,this.height=r}function s(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function u(e,t,n){e&&(e.texture?e.texture._texture.refCount+=1:e.renderbuffer._renderbuffer.refCount+=1)}function c(t,n){n&&(n.texture?e.framebufferTexture2D(36160,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(36160,t,36161,n.renderbuffer._renderbuffer.renderbuffer))}function f(e){var t=3553,n=null,r=null,i=e;return"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),"texture2d"===(e=i._reglType)||"textureCube"===e?n=i:"renderbuffer"===e&&(r=i,t=36161),new a(t,n,r)}function l(e,t,n,o,s){return n?((e=r.create2D({width:e,height:t,format:o,type:s}))._texture.refCount=0,new a(3553,e,null)):((e=i.create({width:e,height:t,format:o}))._renderbuffer.refCount=0,new a(36161,null,e))}function p(e){return e&&(e.texture||e.renderbuffer)}function h(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}function m(){this.id=S++,E[this.id]=this,this.framebuffer=e.createFramebuffer(),this.height=this.width=0,this.colorAttachments=[],this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function d(e){e.colorAttachments.forEach(s),s(e.depthAttachment),s(e.stencilAttachment),s(e.depthStencilAttachment)}function y(t){e.deleteFramebuffer(t.framebuffer),t.framebuffer=null,o.framebufferCount--,delete E[t.id]}function g(t){var r;e.bindFramebuffer(36160,t.framebuffer);var i=t.colorAttachments;for(r=0;r<i.length;++r)c(36064+r,i[r]);for(r=i.length;r<n.maxColorAttachments;++r)e.framebufferTexture2D(36160,36064+r,3553,null,0);e.framebufferTexture2D(36160,33306,3553,null,0),e.framebufferTexture2D(36160,36096,3553,null,0),e.framebufferTexture2D(36160,36128,3553,null,0),c(36096,t.depthAttachment),c(36128,t.stencilAttachment),c(33306,t.depthStencilAttachment),e.checkFramebufferStatus(36160),e.isContextLost(),e.bindFramebuffer(36160,b.next?b.next.framebuffer:null),b.cur=b.next,e.getError()}function v(e,t){function n(e,t){var i,o=0,a=0,s=!0,c=!0;i=null;var h=!0,m="rgba",y="uint8",v=1,b=null,_=null,S=null,E=!1;"number"==typeof e?(o=0|e,a=0|t||o):e?("shape"in e?(o=(a=e.shape)[0],a=a[1]):("radius"in e&&(o=a=e.radius),"width"in e&&(o=e.width),"height"in e&&(a=e.height)),("color"in e||"colors"in e)&&(i=e.color||e.colors,Array.isArray(i)),i||("colorCount"in e&&(v=0|e.colorCount),"colorTexture"in e&&(h=!!e.colorTexture,m="rgba4"),"colorType"in e&&(y=e.colorType,!h)&&("half float"===y||"float16"===y?m="rgba16f":"float"!==y&&"float32"!==y||(m="rgba32f")),"colorFormat"in e&&(m=e.colorFormat,0<=x.indexOf(m)?h=!0:0<=w.indexOf(m)&&(h=!1))),("depthTexture"in e||"depthStencilTexture"in e)&&(E=!(!e.depthTexture&&!e.depthStencilTexture)),"depth"in e&&("boolean"==typeof e.depth?s=e.depth:(b=e.depth,c=!1)),"stencil"in e&&("boolean"==typeof e.stencil?c=e.stencil:(_=e.stencil,s=!1)),"depthStencil"in e&&("boolean"==typeof e.depthStencil?s=c=e.depthStencil:(S=e.depthStencil,c=s=!1))):o=a=1;var A=null,k=null,T=null,j=null;if(Array.isArray(i))A=i.map(f);else if(i)A=[f(i)];else for(A=Array(v),i=0;i<v;++i)A[i]=l(o,a,h,m,y);for(o=o||A[0].width,a=a||A[0].height,b?k=f(b):s&&!c&&(k=l(o,a,E,"depth","uint32")),_?T=f(_):c&&!s&&(T=l(o,a,!1,"stencil","uint8")),S?j=f(S):!b&&!_&&c&&s&&(j=l(o,a,E,"depth stencil","depth stencil")),s=null,i=0;i<A.length;++i)u(A[i]),A[i]&&A[i].texture&&(c=be[A[i].texture._texture.format]*xe[A[i].texture._texture.type],null===s&&(s=c));return u(k),u(T),u(j),d(r),r.width=o,r.height=a,r.colorAttachments=A,r.depthAttachment=k,r.stencilAttachment=T,r.depthStencilAttachment=j,n.color=A.map(p),n.depth=p(k),n.stencil=p(T),n.depthStencil=p(j),n.width=r.width,n.height=r.height,g(r),n}var r=new m;return o.framebufferCount++,n(e,t),U(n,{resize:function(e,t){var i=Math.max(0|e,1),o=Math.max(0|t||i,1);if(i===r.width&&o===r.height)return n;for(var a=r.colorAttachments,s=0;s<a.length;++s)h(a[s],i,o);return h(r.depthAttachment,i,o),h(r.stencilAttachment,i,o),h(r.depthStencilAttachment,i,o),r.width=n.width=i,r.height=n.height=o,g(r),n},_reglType:"framebuffer",_framebuffer:r,destroy:function(){y(r),d(r)},use:function(e){b.setFBO({framebuffer:n},e)}})}var b={cur:null,next:null,dirty:!1,setFBO:null},x=["rgba"],w=["rgba4","rgb565","rgb5 a1"];t.ext_srgb&&w.push("srgba"),t.ext_color_buffer_half_float&&w.push("rgba16f","rgb16f"),t.webgl_color_buffer_float&&w.push("rgba32f");var _=["uint8"];t.oes_texture_half_float&&_.push("half float","float16"),t.oes_texture_float&&_.push("float","float32");var S=0,E={};return U(b,{getFramebuffer:function(e){return"function"==typeof e&&"framebuffer"===e._reglType&&(e=e._framebuffer)instanceof m?e:null},create:v,createCube:function(e){function t(e){var i,o={color:null},a=0,s=null;i="rgba";var u="uint8",c=1;if("number"==typeof e?a=0|e:e?("shape"in e?a=e.shape[0]:("radius"in e&&(a=0|e.radius),"width"in e?a=0|e.width:"height"in e&&(a=0|e.height)),("color"in e||"colors"in e)&&(s=e.color||e.colors,Array.isArray(s)),s||("colorCount"in e&&(c=0|e.colorCount),"colorType"in e&&(u=e.colorType),"colorFormat"in e&&(i=e.colorFormat)),"depth"in e&&(o.depth=e.depth),"stencil"in e&&(o.stencil=e.stencil),"depthStencil"in e&&(o.depthStencil=e.depthStencil)):a=1,s)if(Array.isArray(s))for(e=[],i=0;i<s.length;++i)e[i]=s[i];else e=[s];else for(e=Array(c),s={radius:a,format:i,type:u},i=0;i<c;++i)e[i]=r.createCube(s);for(o.color=Array(e.length),i=0;i<e.length;++i)c=e[i],a=a||c.width,o.color[i]={target:34069,data:e[i]};for(i=0;6>i;++i){for(c=0;c<e.length;++c)o.color[c].target=34069+i;0<i&&(o.depth=n[0].depth,o.stencil=n[0].stencil,o.depthStencil=n[0].depthStencil),n[i]?n[i](o):n[i]=v(o)}return U(t,{width:a,height:a,color:e})}var n=Array(6);return t(e),U(t,{faces:n,resize:function(e){var r=0|e;if(r===t.width)return t;var i=t.color;for(e=0;e<i.length;++e)i[e].resize(r);for(e=0;6>e;++e)n[e].resize(r);return t.width=t.height=r,t},_reglType:"framebufferCube",destroy:function(){n.forEach((function(e){e.destroy()}))}})},clear:function(){G(E).forEach(y)},restore:function(){b.cur=null,b.next=null,b.dirty=!0,G(E).forEach((function(t){t.framebuffer=e.createFramebuffer(),g(t)}))}})}function T(){this.w=this.z=this.y=this.x=this.state=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.divisor=this.stride=this.offset=0}function j(e,t,n,r){function i(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function o(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function a(n,r,i){if(!(a=(i=35632===n?c:f)[r])){var o=t.str(r),a=e.createShader(n);e.shaderSource(a,o),e.compileShader(a),i[r]=a}return a}function s(e,t){this.id=h++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],r.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function u(n,s){var u,c;u=a(35632,n.fragId),c=a(35633,n.vertId);var f=n.program=e.createProgram();e.attachShader(f,u),e.attachShader(f,c),e.linkProgram(f);var l=e.getProgramParameter(f,35718);r.profile&&(n.stats.uniformsCount=l);var p=n.uniforms;for(u=0;u<l;++u)if(c=e.getActiveUniform(f,u))if(1<c.size)for(var h=0;h<c.size;++h){var m=c.name.replace("[0]","["+h+"]");o(p,new i(m,t.id(m),e.getUniformLocation(f,m),c))}else o(p,new i(c.name,t.id(c.name),e.getUniformLocation(f,c.name),c));for(l=e.getProgramParameter(f,35721),r.profile&&(n.stats.attributesCount=l),p=n.attributes,u=0;u<l;++u)(c=e.getActiveAttrib(f,u))&&o(p,new i(c.name,t.id(c.name),e.getAttribLocation(f,c.name),c))}var c={},f={},l={},p=[],h=0;return r.profile&&(n.getMaxUniformsCount=function(){var e=0;return p.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},n.getMaxAttributesCount=function(){var e=0;return p.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);G(c).forEach(t),c={},G(f).forEach(t),f={},p.forEach((function(t){e.deleteProgram(t.program)})),p.length=0,l={},n.shaderCount=0},program:function(e,t,r){var i=l[t];i||(i=l[t]={});var o=i[e];return o||(o=new s(t,e),n.shaderCount++,u(o),i[e]=o,p.push(o)),o},restore:function(){c={},f={};for(var e=0;e<p.length;++e)u(p[e])},shader:a,frag:-1,vert:-1}}function C(e,t,n,r,i,o,a){function s(i){var o;o=null===t.next?5121:t.next.colorAttachments[0].texture._texture.type;var a=0,s=0,u=r.framebufferWidth,c=r.framebufferHeight,f=null;return Q(i)?f=i:i&&(a=0|i.x,s=0|i.y,u=0|(i.width||r.framebufferWidth-a),c=0|(i.height||r.framebufferHeight-s),f=i.data||null),n(),i=u*c*4,f||(5121===o?f=new Uint8Array(i):5126===o&&(f=f||new Float32Array(i))),e.pixelStorei(3333,4),e.readPixels(a,s,u,c,6408,o,f),f}return function(e){return e&&"framebuffer"in e?function(e){var n;return t.setFBO({framebuffer:e.framebuffer},(function(){n=s(e)})),n}(e):s(e)}}function D(e){return Array.prototype.slice.call(e)}function O(e){return D(e).join("")}function F(){function e(){var e=[],t=[];return U((function(){e.push.apply(e,D(arguments))}),{def:function(){var r="v"+n++;return t.push(r),0<arguments.length&&(e.push(r,"="),e.push.apply(e,D(arguments)),e.push(";")),r},toString:function(){return O([0<t.length?"var "+t+";":"",O(e)])}})}function t(){function t(e,t){r(e,t,"=",n.def(e,t),";")}var n=e(),r=e(),i=n.toString,o=r.toString;return U((function(){n.apply(n,D(arguments))}),{def:n.def,entry:n,exit:r,save:t,set:function(e,r,i){t(e,r),n(e,r,"=",i,";")},toString:function(){return i()+o()}})}var n=0,r=[],i=[],o=e(),a={};return{global:o,link:function(e){for(var t=0;t<i.length;++t)if(i[t]===e)return r[t];return t="g"+n++,r.push(t),i.push(e),t},block:e,proc:function(e,n){function r(){var e="a"+i.length;return i.push(e),e}var i=[];n=n||0;for(var o=0;o<n;++o)r();var s=(o=t()).toString;return a[e]=U(o,{arg:r,toString:function(){return O(["function(",i.join(),"){",s(),"}"])}})},scope:t,cond:function(){var e=O(arguments),n=t(),r=t(),i=n.toString,o=r.toString;return U(n,{then:function(){return n.apply(n,D(arguments)),this},else:function(){return r.apply(r,D(arguments)),this},toString:function(){var t=o();return t&&(t="else{"+t+"}"),O(["if(",e,"){",i(),"}",t])}})},compile:function(){var e=['"use strict";',o,"return {"];Object.keys(a).forEach((function(t){e.push('"',t,'":',a[t].toString(),",")})),e.push("}");var t=O(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,r.concat(t)).apply(null,i)}}}function M(e){return Array.isArray(e)||Q(e)||u(e)}function z(e){return e.sort((function(e,t){return"viewport"===e?-1:"viewport"===t?1:e<t?-1:1}))}function L(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function B(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function R(e){return new L(!1,!1,!1,e)}function I(e,t){var n=e.type;return 0===n?new L(!0,1<=(n=e.data.length),2<=n,t):4===n?new L((n=e.data).thisDep,n.contextDep,n.propDep,t):new L(3===n,2===n,1===n,t)}function P(e,t,n,r,i,a,s,u,c,f,l,p,h,m,d){function y(e){return e.replace(".","_")}function v(e,t,n){var r=y(e);te.push(e),ee[r]=Z[r]=!!n,ne[r]=t}function b(e,t,n){var r=y(e);te.push(e),Array.isArray(n)?(Z[r]=n.slice(),ee[r]=n.slice()):Z[r]=ee[r]=n,ie[r]=t}function x(){var e=F(),n=e.link,r=e.global;e.id=se++,e.batchId="0";var i=n(oe),o=e.shared={props:"a0"};Object.keys(oe).forEach((function(e){o[e]=r.def(i,".",e)}));var a=e.next={},s=e.current={};Object.keys(ie).forEach((function(e){Array.isArray(Z[e])&&(a[e]=r.def(o.next,".",e),s[e]=r.def(o.current,".",e))}));var u=e.constants={};Object.keys(ae).forEach((function(e){u[e]=r.def(JSON.stringify(ae[e]))})),e.invoke=function(t,r){switch(r.type){case 0:var i=["this",o.context,o.props,e.batchId];return t.def(n(r.data),".call(",i.slice(0,Math.max(r.data.length+1,4)),")");case 1:return t.def(o.props,r.data);case 2:return t.def(o.context,r.data);case 3:return t.def("this",r.data);case 4:return r.data.append(e,t),r.data.ref}},e.attribCache={};var c={};return e.scopeAttrib=function(e){if((e=t.id(e))in c)return c[e];var r=f.scope[e];return r||(r=f.scope[e]=new Q),c[e]=n(r)},e}function w(e,t){var n=e.static,r=e.dynamic;if("framebuffer"in n){var i=n.framebuffer;return i?(i=u.getFramebuffer(i),R((function(e,t){var n=e.link(i),r=e.shared;return t.set(r.framebuffer,".next",n),r=r.context,t.set(r,".framebufferWidth",n+".width"),t.set(r,".framebufferHeight",n+".height"),n}))):R((function(e,t){var n=e.shared;return t.set(n.framebuffer,".next","null"),n=n.context,t.set(n,".framebufferWidth",n+".drawingBufferWidth"),t.set(n,".framebufferHeight",n+".drawingBufferHeight"),"null"}))}if("framebuffer"in r){var o=r.framebuffer;return I(o,(function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer;return n=t.def(i,".getFramebuffer(",n,")"),t.set(i,".next",n),r=r.context,t.set(r,".framebufferWidth",n+"?"+n+".width:"+r+".drawingBufferWidth"),t.set(r,".framebufferHeight",n+"?"+n+".height:"+r+".drawingBufferHeight"),n}))}return null}function _(e){function n(e){if(e in r){var n=t.id(r[e]);return(e=R((function(){return n}))).id=n,e}if(e in i){var o=i[e];return I(o,(function(e,t){var n=e.invoke(t,o);return t.def(e.shared.strings,".id(",n,")")}))}return null}var r=e.static,i=e.dynamic,o=n("frag"),a=n("vert"),s=null;return B(o)&&B(a)?(s=l.program(a.id,o.id),e=R((function(e,t){return e.link(s)}))):e=new L(o&&o.thisDep||a&&a.thisDep,o&&o.contextDep||a&&a.contextDep,o&&o.propDep||a&&a.propDep,(function(e,t){var n,r,i=e.shared.shader;return n=o?o.append(e,t):t.def(i,".","frag"),r=a?a.append(e,t):t.def(i,".","vert"),t.def(i+".program("+r+","+n+")")})),{frag:o,vert:a,progVar:e,program:s}}function S(e,t){function n(e,t){if(e in r){var n=0|r[e];return R((function(e,r){return t&&(e.OFFSET=n),n}))}if(e in i){var a=i[e];return I(a,(function(e,n){var r=e.invoke(n,a);return t&&(e.OFFSET=r),r}))}return t&&o?R((function(e,t){return e.OFFSET="0",0})):null}var r=e.static,i=e.dynamic,o=function(){if("elements"in r){var e=r.elements;M(e)?e=a.getElements(a.create(e,!0)):e&&(e=a.getElements(e));var t=R((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r}return t.ELEMENTS=null}));return t.value=e,t}if("elements"in i){var n=i.elements;return I(n,(function(e,t){var r=(i=e.shared).isBufferArgs,i=i.elements,o=e.invoke(t,n),a=t.def("null");return r=t.def(r,"(",o,")"),o=e.cond(r).then(a,"=",i,".createStream(",o,");").else(a,"=",i,".getElements(",o,");"),t.entry(o),t.exit(e.cond(r).then(i,".destroyStream(",a,");")),e.ELEMENTS=a}))}return null}(),s=n("offset",!0);return{elements:o,primitive:function(){if("primitive"in r){var e=r.primitive;return R((function(t,n){return re[e]}))}if("primitive"in i){var t=i.primitive;return I(t,(function(e,n){var r=e.constants.primTypes,i=e.invoke(n,t);return n.def(r,"[",i,"]")}))}return o?B(o)?o.value?R((function(e,t){return t.def(e.ELEMENTS,".primType")})):R((function(){return 4})):new L(o.thisDep,o.contextDep,o.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",4)})):null}(),count:function(){if("count"in r){var e=0|r.count;return R((function(){return e}))}if("count"in i){var t=i.count;return I(t,(function(e,n){return e.invoke(n,t)}))}return o?B(o)?o?s?new L(s.thisDep,s.contextDep,s.propDep,(function(e,t){return t.def(e.ELEMENTS,".vertCount-",e.OFFSET)})):R((function(e,t){return t.def(e.ELEMENTS,".vertCount")})):R((function(){return-1})):new L(o.thisDep||s.thisDep,o.contextDep||s.contextDep,o.propDep||s.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")})):null}(),instances:n("instances",!1),offset:s}}function E(e,n){var r=e.static,o=e.dynamic,a={};return Object.keys(r).forEach((function(e){var n=r[e],o=t.id(e),s=new Q;if(M(n))s.state=1,s.buffer=i.getBuffer(i.create(n,34962,!1,!0)),s.type=0;else if(c=i.getBuffer(n))s.state=1,s.buffer=c,s.type=0;else if("constant"in n){var u=n.constant;s.buffer="null",s.state=2,"number"==typeof u?s.x=u:we.forEach((function(e,t){t<u.length&&(s[e]=u[t])}))}else{var c=M(n.buffer)?i.getBuffer(i.create(n.buffer,34962,!1,!0)):i.getBuffer(n.buffer),f=0|n.offset,l=0|n.stride,p=0|n.size,h=!!n.normalized,m=0;"type"in n&&(m=J[n.type]),n=0|n.divisor,s.buffer=c,s.state=1,s.size=p,s.normalized=h,s.type=m||c.dtype,s.offset=f,s.stride=l,s.divisor=n}a[e]=R((function(e,t){var n=e.attribCache;if(o in n)return n[o];var r={isStream:!1};return Object.keys(s).forEach((function(e){r[e]=s[e]})),s.buffer&&(r.buffer=e.link(s.buffer),r.type=r.type||r.buffer+".dtype"),n[o]=r}))})),Object.keys(o).forEach((function(e){var t=o[e];a[e]=I(t,(function(e,n){function r(e){n(u[e],"=",i,".",e,"|0;")}var i=e.invoke(n,t),o=e.shared,a=o.isBufferArgs,s=o.buffer,u={isStream:n.def(!1)},c=new Q;c.state=1,Object.keys(c).forEach((function(e){u[e]=n.def(""+c[e])}));var f=u.buffer,l=u.type;return n("if(",a,"(",i,")){",u.isStream,"=true;",f,"=",s,".createStream(",34962,",",i,");",l,"=",f,".dtype;","}else{",f,"=",s,".getBuffer(",i,");","if(",f,"){",l,"=",f,".dtype;",'}else if("constant" in ',i,"){",u.state,"=",2,";","if(typeof "+i+'.constant === "number"){',u[we[0]],"=",i,".constant;",we.slice(1).map((function(e){return u[e]})).join("="),"=0;","}else{",we.map((function(e,t){return u[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",a,"(",i,".buffer)){",f,"=",s,".createStream(",34962,",",i,".buffer);","}else{",f,"=",s,".getBuffer(",i,".buffer);","}",l,'="type" in ',i,"?",o.glTypes,"[",i,".type]:",f,".dtype;",u.normalized,"=!!",i,".normalized;"),r("size"),r("offset"),r("stride"),r("divisor"),n("}}"),n.exit("if(",u.isStream,"){",s,".destroyStream(",f,");","}"),u}))})),a}function A(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach((function(o){t.save(r,"."+o),i(r,".",o,"=",n[o].append(e,t),";")})),t(i)}function k(e,t,n,r){var i,o=(s=e.shared).gl,a=s.framebuffer;K&&(i=t.def(s.extensions,".webgl_draw_buffers"));var s=(u=e.constants).drawBuffer,u=u.backBuffer;e=n?n.append(e,t):t.def(a,".next"),r||t("if(",e,"!==",a,".cur){"),t("if(",e,"){",o,".bindFramebuffer(",36160,",",e,".framebuffer);"),K&&t(i,".drawBuffersWEBGL(",s,"[",e,".colorAttachments.length]);"),t("}else{",o,".bindFramebuffer(",36160,",null);"),K&&t(i,".drawBuffersWEBGL(",u,");"),t("}",a,".cur=",e,";"),r||t("}")}function T(e,t,n){var r=e.shared,i=r.gl,a=e.current,s=e.next,u=r.current,c=r.next,f=e.cond(u,".dirty");te.forEach((function(t){var r,l;if(!((t=y(t))in n.state))if(t in s){r=s[t],l=a[t];var p=o(Z[t].length,(function(e){return f.def(r,"[",e,"]")}));f(e.cond(p.map((function(e,t){return e+"!=="+l+"["+t+"]"})).join("||")).then(i,".",ie[t],"(",p,");",p.map((function(e,t){return l+"["+t+"]="+e})).join(";"),";"))}else r=f.def(c,".",t),p=e.cond(r,"!==",u,".",t),f(p),t in ne?p(e.cond(r).then(i,".enable(",ne[t],");").else(i,".disable(",ne[t],");"),u,".",t,"=",r,";"):p(i,".",ie[t],"(",r,");",u,".",t,"=",r,";")})),0===Object.keys(n.state).length&&f(u,".dirty=false;"),t(f)}function j(e,t,n,r){var i=e.shared,o=e.current,a=i.current,s=i.gl;z(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var c=u.append(e,t);if(ne[i]){var f=ne[i];B(u)?t(s,c?".enable(":".disable(",f,");"):t(e.cond(c).then(s,".enable(",f,");").else(s,".disable(",f,");")),t(a,".",i,"=",c,";")}else if(g(c)){var l=o[i];t(s,".",ie[i],"(",c,");",c.map((function(e,t){return l+"["+t+"]="+e})).join(";"),";")}else t(s,".",ie[i],"(",c,");",a,".",i,"=",c,";")}}))}function C(e,t){V&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function D(e,t,n,r,i){function o(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function a(e){e(c=t.def(),"=",o(),";"),"string"==typeof i?e(p,".count+=",i,";"):e(p,".count++;"),m&&(r?e(f=t.def(),"=",d,".getNumPendingQueries();"):e(d,".beginQuery(",p,");"))}function s(e){e(p,".cpuTime+=",o(),"-",c,";"),m&&(r?e(d,".pushScopeStats(",f,",",d,".getNumPendingQueries(),",p,");"):e(d,".endQuery();"))}function u(e){var n=t.def(h,".profile");t(h,".profile=",e,";"),t.exit(h,".profile=",n,";")}var c,f,l=e.shared,p=e.stats,h=l.current,d=l.timer;if(n=n.profile){if(B(n))return void(n.enable?(a(t),s(t.exit),u("true")):u("false"));u(n=n.append(e,t))}else n=t.def(h,".profile");a(l=e.block()),t("if(",n,"){",l,"}"),s(e=e.block()),t.exit("if(",n,"){",e,"}")}function O(e,t,n,r,i){function o(n,r,i){function o(){t("if(!",f,".buffer){",u,".enableVertexAttribArray(",c,");}");var n,o=i.type;n=i.size?t.def(i.size,"||",r):r,t("if(",f,".type!==",o,"||",f,".size!==",n,"||",h.map((function(e){return f+"."+e+"!=="+i[e]})).join("||"),"){",u,".bindBuffer(",34962,",",l,".buffer);",u,".vertexAttribPointer(",[c,n,o,i.normalized,i.stride,i.offset],");",f,".type=",o,";",f,".size=",n,";",h.map((function(e){return f+"."+e+"="+i[e]+";"})).join(""),"}"),V&&(o=i.divisor,t("if(",f,".divisor!==",o,"){",e.instancing,".vertexAttribDivisorANGLE(",[c,o],");",f,".divisor=",o,";}"))}function s(){t("if(",f,".buffer){",u,".disableVertexAttribArray(",c,");","}if(",we.map((function(e,t){return f+"."+e+"!=="+p[t]})).join("||"),"){",u,".vertexAttrib4f(",c,",",p,");",we.map((function(e,t){return f+"."+e+"="+p[t]+";"})).join(""),"}")}var u=a.gl,c=t.def(n,".location"),f=t.def(a.attributes,"[",c,"]");n=i.state;var l=i.buffer,p=[i.x,i.y,i.z,i.w],h=["buffer","normalized","offset","stride"];1===n?o():2===n?s():(t("if(",n,"===",1,"){"),o(),t("}else{"),s(),t("}"))}var a=e.shared;r.forEach((function(r){var a,s=r.name,u=n.attributes[s];if(u){if(!i(u))return;a=u.append(e,t)}else{if(!i(Te))return;var c=e.scopeAttrib(s);a={},Object.keys(new Q).forEach((function(e){a[e]=t.def(c,".",e)}))}o(e.link(r),function(e){switch(e){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}(r.info.type),a)}))}function P(e,n,r,i,a){for(var s,u=e.shared,c=u.gl,f=0;f<i.length;++f){var l,p=(d=i[f]).name,h=d.info.type,m=r.uniforms[p],d=e.link(d)+".location";if(m){if(!a(m))continue;if(B(m)){if(p=m.value,35678===h||35680===h)n(c,".uniform1i(",d,",",(h=e.link(p._texture||p.color[0]._texture))+".bind());"),n.exit(h,".unbind();");else if(35674===h||35675===h||35676===h)m=2,35675===h?m=3:35676===h&&(m=4),n(c,".uniformMatrix",m,"fv(",d,",false,",p=e.global.def("new Float32Array(["+Array.prototype.slice.call(p)+"])"),");");else{switch(h){case 5126:s="1f";break;case 35664:s="2f";break;case 35665:s="3f";break;case 35666:s="4f";break;case 35670:case 5124:s="1i";break;case 35671:case 35667:s="2i";break;case 35672:case 35668:s="3i";break;case 35673:case 35669:s="4i"}n(c,".uniform",s,"(",d,",",g(p)?Array.prototype.slice.call(p):p,");")}continue}l=m.append(e,n)}else{if(!a(Te))continue;l=n.def(u.uniforms,"[",t.id(p),"]")}switch(35678===h?n("if(",l,"&&",l,'._reglType==="framebuffer"){',l,"=",l,".color[0];","}"):35680===h&&n("if(",l,"&&",l,'._reglType==="framebufferCube"){',l,"=",l,".color[0];","}"),p=1,h){case 35678:case 35680:h=n.def(l,"._texture"),n(c,".uniform1i(",d,",",h,".bind());"),n.exit(h,".unbind();");continue;case 5124:case 35670:s="1i";break;case 35667:case 35671:s="2i",p=2;break;case 35668:case 35672:s="3i",p=3;break;case 35669:case 35673:s="4i",p=4;break;case 5126:s="1f";break;case 35664:s="2f",p=2;break;case 35665:s="3f",p=3;break;case 35666:s="4f",p=4;break;case 35674:s="Matrix2fv";break;case 35675:s="Matrix3fv";break;case 35676:s="Matrix4fv"}if(n(c,".uniform",s,"(",d,","),"M"===s.charAt(0)){d=Math.pow(h-35674+2,2);var y=e.global.def("new Float32Array(",d,")");n("false,(Array.isArray(",l,")||",l," instanceof Float32Array)?",l,":(",o(d,(function(e){return y+"["+e+"]="+l+"["+e+"]"})),",",y,")")}else n(1<p?o(p,(function(e){return l+"["+e+"]"})):l);n(");")}}function q(e,t,n,r){function i(i){var o=p[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(e,n):o.append(e,t):t.def(l,".",i)}function o(){function e(){n(u,".drawElementsInstancedANGLE(",[m,y,g,d+"<<(("+g+"-5121)>>1)",s],");")}function t(){n(u,".drawArraysInstancedANGLE(",[m,d,y,s],");")}h?v?e():(n("if(",h,"){"),e(),n("}else{"),t(),n("}")):t()}function a(){function e(){n(f+".drawElements("+[m,y,g,d+"<<(("+g+"-5121)>>1)"]+");")}function t(){n(f+".drawArrays("+[m,d,y]+");")}h?v?e():(n("if(",h,"){"),e(),n("}else{"),t(),n("}")):t()}var s,u,c=e.shared,f=c.gl,l=c.draw,p=r.draw,h=function(){var i=p.elements,o=t;return i?((i.contextDep&&r.contextDynamic||i.propDep)&&(o=n),i=i.append(e,o)):i=o.def(l,".","elements"),i&&o("if("+i+")"+f+".bindBuffer(34963,"+i+".buffer.buffer);"),i}(),m=i("primitive"),d=i("offset"),y=function(){var i=p.count,o=t;return i?((i.contextDep&&r.contextDynamic||i.propDep)&&(o=n),i=i.append(e,o)):i=o.def(l,".","count"),i}();if("number"==typeof y){if(0===y)return}else n("if(",y,"){"),n.exit("}");V&&(s=i("instances"),u=e.instancing);var g=h+".type",v=p.elements&&B(p.elements);V&&("number"!=typeof s||0<=s)?"string"==typeof s?(n("if(",s,">0){"),o(),n("}else if(",s,"<0){"),a(),n("}")):o():a()}function U(e,t,n,r,i){return i=(t=x()).proc("body",i),V&&(t.instancing=i.def(t.shared.extensions,".angle_instanced_arrays")),e(t,i,n,r),t.compile().body}function $(e,t,n,r){C(e,t),O(e,t,n,r.attributes,(function(){return!0})),P(e,t,n,r.uniforms,(function(){return!0})),q(e,t,t,n)}function H(e,t,n,r){function i(){return!0}e.batchId="a1",C(e,t),O(e,t,n,r.attributes,i),P(e,t,n,r.uniforms,i),q(e,t,t,n)}function W(e,t,n,r){function i(e){return e.contextDep&&a||e.propDep}function o(e){return!i(e)}C(e,t);var a=n.contextDep,s=t.def(),u=t.def();e.shared.props=u,e.batchId=s;var c=e.scope(),f=e.scope();t(c.entry,"for(",s,"=0;",s,"<","a1",";++",s,"){",u,"=","a0","[",s,"];",f,"}",c.exit),n.needsContext&&A(e,f,n.context),n.needsFramebuffer&&k(e,f,n.framebuffer),j(e,f,n.state,i),n.profile&&i(n.profile)&&D(e,f,n,!1,!0),r?(O(e,c,n,r.attributes,o),O(e,f,n,r.attributes,i),P(e,c,n,r.uniforms,o),P(e,f,n,r.uniforms,i),q(e,c,f,n)):(t=e.global.def("{}"),r=n.shader.progVar.append(e,f),u=f.def(r,".id"),c=f.def(t,"[",u,"]"),f(e.shared.gl,".useProgram(",r,".program);","if(!",c,"){",c,"=",t,"[",u,"]=",e.link((function(t){return U(H,e,n,t,2)})),"(",r,");}",c,".call(this,a0[",s,"],",s,");"))}function X(e,n){function r(t){var r=n.shader[t];r&&i.set(o.shader,"."+t,r.append(e,i))}var i=e.proc("scope",3);e.batchId="a2";var o=e.shared,a=o.current;A(e,i,n.context),n.framebuffer&&n.framebuffer.append(e,i),z(Object.keys(n.state)).forEach((function(t){var r=n.state[t].append(e,i);g(r)?r.forEach((function(n,r){i.set(e.next[t],"["+r+"]",n)})):i.set(o.next,"."+t,r)})),D(e,i,n,!0,!0),["elements","offset","count","instances","primitive"].forEach((function(t){var r=n.draw[t];r&&i.set(o.draw,"."+t,""+r.append(e,i))})),Object.keys(n.uniforms).forEach((function(r){i.set(o.uniforms,"["+t.id(r)+"]",n.uniforms[r].append(e,i))})),Object.keys(n.attributes).forEach((function(t){var r=n.attributes[t].append(e,i),o=e.scopeAttrib(t);Object.keys(new Q).forEach((function(e){i.set(o,"."+e,r[e])}))})),r("vert"),r("frag"),0<Object.keys(n.state).length&&(i(a,".dirty=true;"),i.exit(a,".dirty=true;")),i("a1(",e.shared.context,",a0,",e.batchId,");")}function Y(e,t,n){var r=t.static[n];if(r&&function(e){if("object"==typeof e&&!g(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(N.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,o=Object.keys(r),a=!1,s=!1,u=!1,c=e.global.def("{}");o.forEach((function(t){var n=r[t];if(N.isDynamic(n))"function"==typeof n&&(n=r[t]=N.unbox(n)),t=I(n,null),a=a||t.thisDep,u=u||t.propDep,s=s||t.contextDep;else{switch(i(c,".",t,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}})),t.dynamic[n]=new N.DynamicVariable(4,{thisDep:a,contextDep:s,propDep:u,ref:c,append:function(e,t){o.forEach((function(n){var i=r[n];N.isDynamic(i)&&(i=e.invoke(t,i),t(c,".",n,"=",i,";"))}))}}),delete t.static[n]}}var Q=f.Record,G={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(G.min=32775,G.max=32776);var V=n.angle_instanced_arrays,K=n.webgl_draw_buffers,Z={dirty:!0,profile:d.profile},ee={},te=[],ne={},ie={};v("dither",3024),v("blend.enable",3042),b("blend.color","blendColor",[0,0,0,0]),b("blend.equation","blendEquationSeparate",[32774,32774]),b("blend.func","blendFuncSeparate",[1,0,1,0]),v("depth.enable",2929,!0),b("depth.func","depthFunc",513),b("depth.range","depthRange",[0,1]),b("depth.mask","depthMask",!0),b("colorMask","colorMask",[!0,!0,!0,!0]),v("cull.enable",2884),b("cull.face","cullFace",1029),b("frontFace","frontFace",2305),b("lineWidth","lineWidth",1),v("polygonOffset.enable",32823),b("polygonOffset.offset","polygonOffset",[0,0]),v("sample.alpha",32926),v("sample.enable",32928),b("sample.coverage","sampleCoverage",[1,!1]),v("stencil.enable",2960),b("stencil.mask","stencilMask",-1),b("stencil.func","stencilFunc",[519,0,-1]),b("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),b("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),v("scissor.enable",3089),b("scissor.box","scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),b("viewport","viewport",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var oe={gl:e,context:h,strings:t,next:ee,current:Z,draw:p,elements:a,buffer:i,shader:l,attributes:f.state,uniforms:c,framebuffer:u,extensions:n,timer:m,isBufferArgs:M},ae={primTypes:re,compareFuncs:Ee,blendFuncs:Se,blendEquations:G,stencilOps:Ae,glTypes:J,orientationType:ke};K&&(ae.backBuffer=[1029],ae.drawBuffer=o(r.maxDrawbuffers,(function(e){return 0===e?[0]:o(e,(function(e){return 36064+e}))})));var se=0;return{next:ee,current:Z,procs:function(){var e=x(),t=e.proc("poll"),n=e.proc("refresh"),i=e.block();t(i),n(i);var a,s=e.shared,u=s.gl,c=s.next,f=s.current;i(f,".dirty=false;"),k(e,t),k(e,n,null,!0),V&&(a=e.link(V));for(var l=0;l<r.maxAttributes;++l){var p=n.def(s.attributes,"[",l,"]"),h=e.cond(p,".buffer");h.then(u,".enableVertexAttribArray(",l,");",u,".bindBuffer(",34962,",",p,".buffer.buffer);",u,".vertexAttribPointer(",l,",",p,".size,",p,".type,",p,".normalized,",p,".stride,",p,".offset);").else(u,".disableVertexAttribArray(",l,");",u,".vertexAttrib4f(",l,",",p,".x,",p,".y,",p,".z,",p,".w);",p,".buffer=null;"),n(h),V&&n(a,".vertexAttribDivisorANGLE(",l,",",p,".divisor);")}return Object.keys(ne).forEach((function(r){var o=ne[r],a=i.def(c,".",r),s=e.block();s("if(",a,"){",u,".enable(",o,")}else{",u,".disable(",o,")}",f,".",r,"=",a,";"),n(s),t("if(",a,"!==",f,".",r,"){",s,"}")})),Object.keys(ie).forEach((function(r){var a,s,l=ie[r],p=Z[r],h=e.block();h(u,".",l,"("),g(p)?(l=p.length,a=e.global.def(c,".",r),s=e.global.def(f,".",r),h(o(l,(function(e){return a+"["+e+"]"})),");",o(l,(function(e){return s+"["+e+"]="+a+"["+e+"];"})).join("")),t("if(",o(l,(function(e){return a+"["+e+"]!=="+s+"["+e+"]"})).join("||"),"){",h,"}")):(a=i.def(c,".",r),s=i.def(f,".",r),h(a,");",f,".",r,"=",a,";"),t("if(",a,"!==",s,"){",h,"}")),n(h)})),e.compile()}(),compile:function(e,t,n,r,i){var a=x();return a.stats=a.link(i),Object.keys(t.static).forEach((function(e){Y(a,t,e)})),_e.forEach((function(t){Y(a,e,t)})),n=function(e,t,n,r,i){var a=w(e),s=function(e,t,n){function r(e){if(e in i){var n=i[e];e=!0;var r,a,s=0|n.x,u=0|n.y;return"width"in n?r=0|n.width:e=!1,"height"in n?a=0|n.height:e=!1,new L(!e&&t&&t.thisDep,!e&&t&&t.contextDep,!e&&t&&t.propDep,(function(e,t){var i=e.shared.context,o=r;"width"in n||(o=t.def(i,".","framebufferWidth","-",s));var c=a;return"height"in n||(c=t.def(i,".","framebufferHeight","-",u)),[s,u,o,c]}))}if(e in o){var c=o[e];return e=I(c,(function(e,t){var n=e.invoke(t,c),r=e.shared.context,i=t.def(n,".x|0"),o=t.def(n,".y|0");return[i,o,t.def('"width" in ',n,"?",n,".width|0:","(",r,".","framebufferWidth","-",i,")"),n=t.def('"height" in ',n,"?",n,".height|0:","(",r,".","framebufferHeight","-",o,")")]})),t&&(e.thisDep=e.thisDep||t.thisDep,e.contextDep=e.contextDep||t.contextDep,e.propDep=e.propDep||t.propDep),e}return t?new L(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".","framebufferWidth"),t.def(n,".","framebufferHeight")]})):null}var i=e.static,o=e.dynamic;if(e=r("viewport")){var a=e;e=new L(e.thisDep,e.contextDep,e.propDep,(function(e,t){var n=a.append(e,t),r=e.shared.context;return t.set(r,".viewportWidth",n[2]),t.set(r,".viewportHeight",n[3]),n}))}return{viewport:e,scissor_box:r("scissor.box")}}(e,a),u=S(e),c=function(e,t){var n=e.static,r=e.dynamic,i={};return te.forEach((function(e){function t(t,o){if(e in n){var s=t(n[e]);i[a]=R((function(){return s}))}else if(e in r){var u=r[e];i[a]=I(u,(function(e,t){return o(e,t,e.invoke(t,u))}))}}var a=y(e);switch(e){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":case"lineWidth":return t((function(e){return e}),(function(e,t,n){return n}));case"depth.func":return t((function(e){return Ee[e]}),(function(e,t,n){return t.def(e.constants.compareFuncs,"[",n,"]")}));case"depth.range":return t((function(e){return e}),(function(e,t,n){return[t.def("+",n,"[0]"),t=t.def("+",n,"[1]")]}));case"blend.func":return t((function(e){return[Se["srcRGB"in e?e.srcRGB:e.src],Se["dstRGB"in e?e.dstRGB:e.dst],Se["srcAlpha"in e?e.srcAlpha:e.src],Se["dstAlpha"in e?e.dstAlpha:e.dst]]}),(function(e,t,n){function r(e,r){return t.def('"',e,r,'" in ',n,"?",n,".",e,r,":",n,".",e)}e=e.constants.blendFuncs;var i=r("src","RGB"),o=r("dst","RGB"),a=(i=t.def(e,"[",i,"]"),t.def(e,"[",r("src","Alpha"),"]"));return[i,o=t.def(e,"[",o,"]"),a,e=t.def(e,"[",r("dst","Alpha"),"]")]}));case"blend.equation":return t((function(e){return"string"==typeof e?[G[e],G[e]]:"object"==typeof e?[G[e.rgb],G[e.alpha]]:void 0}),(function(e,t,n){var r=e.constants.blendEquations,i=t.def(),o=t.def();return(e=e.cond("typeof ",n,'==="string"')).then(i,"=",o,"=",r,"[",n,"];"),e.else(i,"=",r,"[",n,".rgb];",o,"=",r,"[",n,".alpha];"),t(e),[i,o]}));case"blend.color":return t((function(e){return o(4,(function(t){return+e[t]}))}),(function(e,t,n){return o(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case"stencil.mask":return t((function(e){return 0|e}),(function(e,t,n){return t.def(n,"|0")}));case"stencil.func":return t((function(e){return[Ee[e.cmp||"keep"],e.ref||0,"mask"in e?e.mask:-1]}),(function(e,t,n){return[e=t.def('"cmp" in ',n,"?",e.constants.compareFuncs,"[",n,".cmp]",":",7680),t.def(n,".ref|0"),t=t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case"stencil.opFront":case"stencil.opBack":return t((function(t){return["stencil.opBack"===e?1029:1028,Ae[t.fail||"keep"],Ae[t.zfail||"keep"],Ae[t.zpass||"keep"]]}),(function(t,n,r){function i(e){return n.def('"',e,'" in ',r,"?",o,"[",r,".",e,"]:",7680)}var o=t.constants.stencilOps;return["stencil.opBack"===e?1029:1028,i("fail"),i("zfail"),i("zpass")]}));case"polygonOffset.offset":return t((function(e){return[0|e.factor,0|e.units]}),(function(e,t,n){return[t.def(n,".factor|0"),t=t.def(n,".units|0")]}));case"cull.face":return t((function(e){var t=0;return"front"===e?t=1028:"back"===e&&(t=1029),t}),(function(e,t,n){return t.def(n,'==="front"?',1028,":",1029)}));case"frontFace":return t((function(e){return ke[e]}),(function(e,t,n){return t.def(n+'==="cw"?2304:2305')}));case"colorMask":return t((function(e){return e.map((function(e){return!!e}))}),(function(e,t,n){return o(4,(function(e){return"!!"+n+"["+e+"]"}))}));case"sample.coverage":return t((function(e){return["value"in e?e.value:1,!!e.invert]}),(function(e,t,n){return[t.def('"value" in ',n,"?+",n,".value:1"),t=t.def("!!",n,".invert")]}))}})),i}(e),f=_(e),l=s.viewport;return l&&(c.viewport=l),(s=s[l=y("scissor.box")])&&(c[l]=s),(a={framebuffer:a,draw:u,shader:f,state:c,dirty:s=0<Object.keys(c).length}).profile=function(e){var t,n=e.static;if(e=e.dynamic,"profile"in n){var r=!!n.profile;(t=R((function(e,t){return r}))).enable=r}else if("profile"in e){var i=e.profile;t=I(i,(function(e,t){return e.invoke(t,i)}))}return t}(e),a.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach((function(e){var t,r=n[e];if("number"==typeof r||"boolean"==typeof r)t=R((function(){return r}));else if("function"==typeof r){var a=r._reglType;"texture2d"===a||"textureCube"===a?t=R((function(e){return e.link(r)})):"framebuffer"!==a&&"framebufferCube"!==a||(t=R((function(e){return e.link(r.color[0])})))}else g(r)&&(t=R((function(e){return e.global.def("[",o(r.length,(function(e){return r[e]})),"]")})));t.value=r,i[e]=t})),Object.keys(r).forEach((function(e){var t=r[e];i[e]=I(t,(function(e,n){return e.invoke(n,t)}))})),i}(n),a.attributes=E(t),a.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=R((function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=I(t,(function(e,n){return e.invoke(n,t)}))})),r}(r),a}(e,t,n,r),function(e,t){var n=e.proc("draw",1);C(e,n),A(e,n,t.context),k(e,n,t.framebuffer),T(e,n,t),j(e,n,t.state),D(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)$(e,n,t,t.shader.program);else{var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link((function(n){return U($,e,t,n,1)})),"(",r,");",a,".call(this,a0);"))}0<Object.keys(t.state).length&&n(e.shared.current,".dirty=true;")}(a,n),X(a,n),function(e,t){function n(e){return e.contextDep&&i||e.propDep}var r=e.proc("batch",2);e.batchId="0",C(e,r);var i=!1,o=!0;Object.keys(t.context).forEach((function(e){i=i||t.context[e].propDep})),i||(A(e,r,t.context),o=!1);var a=!1;if((s=t.framebuffer)?(s.propDep?i=a=!0:s.contextDep&&i&&(a=!0),a||k(e,r,s)):k(e,r,null),t.state.viewport&&t.state.viewport.propDep&&(i=!0),T(e,r,t),j(e,r,t.state,(function(e){return!n(e)})),t.profile&&n(t.profile)||D(e,r,t,!1,"a1"),t.contextDep=i,t.needsContext=o,t.needsFramebuffer=a,(o=t.shader.progVar).contextDep&&i||o.propDep)W(e,r,t,null);else if(o=o.append(e,r),r(e.shared.gl,".useProgram(",o,".program);"),t.shader.program)W(e,r,t,t.shader.program);else{var s=e.global.def("{}"),u=(a=r.def(o,".id"),r.def(s,"[",a,"]"));r(e.cond(u).then(u,".call(this,a0,a1);").else(u,"=",s,"[",a,"]=",e.link((function(n){return U(W,e,t,n,2)})),"(",o,");",u,".call(this,a0,a1);"))}0<Object.keys(t.state).length&&r(e.shared.current,".dirty=true;")}(a,n),a.compile()}}}function q(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}var U=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e},$=0,N={DynamicVariable:e,define:function(t,r){return new e(t,n(r+""))},isDynamic:function(t){return"function"==typeof t&&!t._reglType||t instanceof e},unbox:function(t,n){return"function"==typeof t?new e(0,t):t},accessor:n},H={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},W="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},X=s();X.zero=s();var Y=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){o=e.createTexture(),e.bindTexture(3553,o),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var a=e.createFramebuffer();if(e.bindFramebuffer(36160,a),e.framebufferTexture2D(36160,36064,3553,o,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var s=X.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,s),e.getError()?o=!1:(e.deleteFramebuffer(a),e.deleteTexture(o),o=1===s[0]),X.freeType(s)}}return s=!0,s=e.createTexture(),a=X.allocType(5121,36),e.activeTexture(33984),e.bindTexture(34067,s),e.texImage2D(34069,0,6408,3,3,0,6408,5121,a),X.freeType(a),e.bindTexture(34067,null),e.deleteTexture(s),s=!e.getError(),{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:s}},Q=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},G=function(e){return Object.keys(e).map((function(t){return e[t]}))},V={shape:function(e){for(var t=[];e.length;e=e[0])t.push(e.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;switch(n=r||X.allocType(n,i),t.length){case 0:break;case 1:for(r=t[0],t=0;t<r;++t)n[t]=e[t];break;case 2:for(r=t[0],t=t[1],o=i=0;o<r;++o)for(var a=e[o],s=0;s<t;++s)n[i++]=a[s];break;case 3:c(e,t[0],t[1],t[2],n,0);break;default:f(e,t,0,n,0)}return n}},K={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},J={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Z={dynamic:35048,stream:35040,static:35044},ee=V.flatten,te=V.shape,ne=[];ne[5120]=1,ne[5122]=2,ne[5124]=4,ne[5121]=1,ne[5123]=2,ne[5125]=4,ne[5126]=4;var re={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ie=new Float32Array(1),oe=new Uint32Array(ie.buffer),ae=[9984,9986,9985,9987],se=[0,6409,6410,6407,6408],ue={};ue[6409]=ue[6406]=ue[6402]=1,ue[34041]=ue[6410]=2,ue[6407]=ue[35904]=3,ue[6408]=ue[35906]=4;var ce=v("HTMLCanvasElement"),fe=v("CanvasRenderingContext2D"),le=v("ImageBitmap"),pe=v("HTMLImageElement"),he=v("HTMLVideoElement"),me=Object.keys(K).concat([ce,fe,le,pe,he]),de=[];de[5121]=1,de[5126]=4,de[36193]=2,de[5123]=2,de[5125]=4;var ye=[];ye[32854]=2,ye[32855]=2,ye[36194]=2,ye[34041]=4,ye[33776]=.5,ye[33777]=.5,ye[33778]=1,ye[33779]=1,ye[35986]=.5,ye[35987]=1,ye[34798]=1,ye[35840]=.5,ye[35841]=.25,ye[35842]=.5,ye[35843]=.25,ye[36196]=.5;var ge=[];ge[32854]=2,ge[32855]=2,ge[36194]=2,ge[33189]=2,ge[36168]=1,ge[34041]=4,ge[35907]=4,ge[34836]=16,ge[34842]=8,ge[34843]=6;var ve=function(e,t,n,r,i){function o(e){this.id=c++,this.refCount=1,this.renderbuffer=e,this.format=32854,this.height=this.width=0,i.profile&&(this.stats={size:0})}function a(t){var n=t.renderbuffer;e.bindRenderbuffer(36161,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete f[t.id],r.renderbufferCount--}var s={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(s.srgba=35907),t.ext_color_buffer_half_float&&(s.rgba16f=34842,s.rgb16f=34843),t.webgl_color_buffer_float&&(s.rgba32f=34836);var u=[];Object.keys(s).forEach((function(e){u[s[e]]=e}));var c=0,f={};return o.prototype.decRef=function(){0>=--this.refCount&&a(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(f).forEach((function(t){e+=f[t].stats.size})),e}),{create:function(t,n){function a(t,n){var r=0,o=0,f=32854;if("object"==typeof t&&t?("shape"in t?(r=0|(o=t.shape)[0],o=0|o[1]):("radius"in t&&(r=o=0|t.radius),"width"in t&&(r=0|t.width),"height"in t&&(o=0|t.height)),"format"in t&&(f=s[t.format])):"number"==typeof t?(r=0|t,o="number"==typeof n?0|n:r):t||(r=o=1),r!==c.width||o!==c.height||f!==c.format)return a.width=c.width=r,a.height=c.height=o,c.format=f,e.bindRenderbuffer(36161,c.renderbuffer),e.renderbufferStorage(36161,f,r,o),i.profile&&(c.stats.size=ge[c.format]*c.width*c.height),a.format=u[c.format],a}var c=new o(e.createRenderbuffer());return f[c.id]=c,r.renderbufferCount++,a(t,n),a.resize=function(t,n){var r=0|t,o=0|n||r;return r===c.width&&o===c.height||(a.width=c.width=r,a.height=c.height=o,e.bindRenderbuffer(36161,c.renderbuffer),e.renderbufferStorage(36161,c.format,r,o),i.profile&&(c.stats.size=ge[c.format]*c.width*c.height)),a},a._reglType="renderbuffer",a._renderbuffer=c,i.profile&&(a.stats=c.stats),a.destroy=function(){c.decRef()},a},clear:function(){G(f).forEach(a)},restore:function(){G(f).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,t.renderbuffer),e.renderbufferStorage(36161,t.format,t.width,t.height)})),e.bindRenderbuffer(36161,null)}}},be=[];be[6408]=4,be[6407]=3;var xe=[];xe[5121]=1,xe[5126]=4,xe[36193]=2;var we=["x","y","z","w"],_e="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),Se={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Ee={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ae={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ke={cw:2304,ccw:2305},Te=new L(!1,!1,!1,(function(){}));return function(e){function t(){if(0===V.length)S&&S.update(),ee=null;else{ee=H.next(t),p();for(var e=V.length-1;0<=e;--e){var n=V[e];n&&n(F,null,0)}g.flush(),S&&S.update()}}function n(){!ee&&0<V.length&&(ee=H.next(t))}function o(){ee&&(H.cancel(t),ee=null)}function a(e){e.preventDefault(),o(),K.forEach((function(e){e()}))}function s(e){g.getError(),b.restore(),B.restore(),z.restore(),R.restore(),I.restore(),$.restore(),S&&S.restore(),X.procs.refresh(),n(),J.forEach((function(e){e()}))}function u(e){function t(e){var t={},n={};return Object.keys(e).forEach((function(r){var i=e[r];N.isDynamic(i)?n[r]=N.unbox(i,r):t[r]=i})),{dynamic:n,static:t}}var n=t(e.context||{}),r=t(e.uniforms||{}),i=t(e.attributes||{}),o=t(function(e){function t(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach((function(r){n[e+"."+r]=t[r]}))}}var n=U({},e);return delete n.uniforms,delete n.attributes,delete n.context,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),t("blend"),t("depth"),t("cull"),t("stencil"),t("polygonOffset"),t("scissor"),t("sample"),n}(e));e={gpuTime:0,cpuTime:0,count:0};var a=(n=X.compile(o,i,r,n,e)).draw,s=n.batch,u=n.scope,c=[];return U((function(e,t){var n;if("function"==typeof e)return u.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)u.call(this,null,t,n);else{if(!Array.isArray(e))return u.call(this,e,t,0);for(n=0;n<e.length;++n)u.call(this,e[n],t,n)}else if("number"==typeof e){if(0<e)return s.call(this,function(e){for(;c.length<e;)c.push(null);return c}(0|e),0|e)}else{if(!Array.isArray(e))return a.call(this,e);if(e.length)return s.call(this,e,e.length)}}),{stats:e})}function c(e,t){var n=0;X.procs.poll();var r=t.color;r&&(g.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in t&&(g.clearDepth(+t.depth),n|=256),"stencil"in t&&(g.clearStencil(0|t.stencil),n|=1024),g.clear(n)}function f(e){return V.push(e),n(),{cancel:function(){var t=q(V,e);V[t]=function e(){var t=q(V,e);V[t]=V[V.length-1],--V.length,0>=V.length&&o()}}}}function l(){var e=Q.viewport,t=Q.scissor_box;e[0]=e[1]=t[0]=t[1]=0,F.viewportWidth=F.framebufferWidth=F.drawingBufferWidth=e[2]=t[2]=g.drawingBufferWidth,F.viewportHeight=F.framebufferHeight=F.drawingBufferHeight=e[3]=t[3]=g.drawingBufferHeight}function p(){F.tick+=1,F.time=y(),l(),X.procs.poll()}function h(){l(),X.procs.refresh(),S&&S.update()}function y(){return(W()-E)/1e3}if(!(e=function(e){var t,n,o,a,s=e||{};e={};var u=[],c=[],f="undefined"==typeof window?1:window.devicePixelRatio,l=!1,p=function(e){},h=function(){};if("string"==typeof s?t=document.querySelector(s):"object"==typeof s&&("string"==typeof s.nodeName&&"function"==typeof s.appendChild&&"function"==typeof s.getBoundingClientRect?t=s:"function"==typeof s.drawArrays||"function"==typeof s.drawElements?o=(a=s).canvas:("gl"in s?a=s.gl:"canvas"in s?o=i(s.canvas):"container"in s&&(n=i(s.container)),"attributes"in s&&(e=s.attributes),"extensions"in s&&(u=r(s.extensions)),"optionalExtensions"in s&&(c=r(s.optionalExtensions)),"onDone"in s&&(p=s.onDone),"profile"in s&&(l=!!s.profile),"pixelRatio"in s&&(f=+s.pixelRatio))),t&&("canvas"===t.nodeName.toLowerCase()?o=t:n=t),!a){if(!o){if(t=function(e,t,n){function r(){var t=window.innerWidth,r=window.innerHeight;e!==document.body&&(t=(r=e.getBoundingClientRect()).right-r.left,r=r.bottom-r.top),i.width=n*t,i.height=n*r,U(i.style,{width:t+"px",height:r+"px"})}var i=document.createElement("canvas");return U(i.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(i),e===document.body&&(i.style.position="absolute",U(e.style,{margin:0,padding:0})),window.addEventListener("resize",r,!1),r(),{canvas:i,onDestroy:function(){window.removeEventListener("resize",r),e.removeChild(i)}}}(n||document.body,0,f),!t)return null;o=t.canvas,h=t.onDestroy}a=function(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(o,e)}return a?{gl:a,canvas:o,container:n,extensions:u,optionalExtensions:c,pixelRatio:f,profile:l,onDone:p,onDestroy:h}:(h(),p("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}(e)))return null;var g=e.gl,v=g.getContextAttributes();g.isContextLost();var b=function(e,t){function n(t){var n;t=t.toLowerCase();try{n=r[t]=e.getExtension(t)}catch(e){}return!!n}for(var r={},i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!n(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(n),{extensions:r,restore:function(){Object.keys(r).forEach((function(e){if(r[e]&&!n(e))throw Error("(regl): error restoring extension "+e)}))}}}(g,e);if(!b)return null;var x=function(){var e={"":0},t=[""];return{id:function(n){var r=e[n];return r||(r=e[n]=t.length,t.push(n),r)},str:function(e){return t[e]}}}(),w={bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},_=b.extensions,S=function(e,t){function n(){this.endQueryIndex=this.startQueryIndex=-1,this.sum=0,this.stats=null}function r(e,t,r){var i=a.pop()||new n;i.startQueryIndex=e,i.endQueryIndex=t,i.sum=0,i.stats=r,s.push(i)}if(!t.ext_disjoint_timer_query)return null;var i=[],o=[],a=[],s=[],u=[],c=[];return{beginQuery:function(e){var n=i.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,n),o.push(n),r(o.length-1,o.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:r,update:function(){var e,n;if(0!==(e=o.length)){c.length=Math.max(c.length,e+1),u.length=Math.max(u.length,e+1),u[0]=0;var r=c[0]=0;for(n=e=0;n<o.length;++n){var f=o[n];t.ext_disjoint_timer_query.getQueryObjectEXT(f,34919)?(r+=t.ext_disjoint_timer_query.getQueryObjectEXT(f,34918),i.push(f)):o[e++]=f,u[n+1]=r,c[n+1]=e}for(o.length=e,n=e=0;n<s.length;++n){var l=(r=s[n]).startQueryIndex;f=r.endQueryIndex,r.sum+=u[f]-u[l],l=c[l],(f=c[f])===l?(r.stats.gpuTime+=r.sum/1e6,a.push(r)):(r.startQueryIndex=l,r.endQueryIndex=f,s[e++]=r)}s.length=e}},getNumPendingQueries:function(){return o.length},clear:function(){i.push.apply(i,o);for(var e=0;e<i.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(i[e]);o.length=0,i.length=0},restore:function(){o.length=0,i.length=0}}}(0,_),E=W(),D=g.drawingBufferWidth,O=g.drawingBufferHeight,F={tick:0,time:0,viewportWidth:D,viewportHeight:O,framebufferWidth:D,framebufferHeight:O,drawingBufferWidth:D,drawingBufferHeight:O,pixelRatio:e.pixelRatio},M=Y(g,_),z=(D=function(e,t,n,r){for(e=n.maxAttributes,t=Array(e),n=0;n<e;++n)t[n]=new T;return{Record:T,scope:{},state:t}}(g,_,M),m(g,w,e,D)),L=d(g,_,z,w),B=j(g,x,w,e),R=A(g,_,M,(function(){X.procs.poll()}),F,w,e),I=ve(g,_,0,w,e),$=k(g,_,M,R,I,w),X=P(g,x,_,M,z,L,0,$,{},D,B,{elements:null,primitive:4,count:-1,offset:0,instances:-1},F,S,e),Q=(x=C(g,$,X.procs.poll,F),X.next),G=g.canvas,V=[],K=[],J=[],Z=[e.onDestroy],ee=null;G&&(G.addEventListener("webglcontextlost",a,!1),G.addEventListener("webglcontextrestored",s,!1));var te=$.setFBO=u({framebuffer:N.define.call(null,1,"framebuffer")});return h(),v=U(u,{clear:function(e){if("framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var t=0;6>t;++t)te(U({framebuffer:e.framebuffer.faces[t]},e),c);else te(e,c);else c(0,e)},prop:N.define.bind(null,1),context:N.define.bind(null,2),this:N.define.bind(null,3),draw:u({}),buffer:function(e){return z.create(e,34962,!1,!1)},elements:function(e){return L.create(e,!1)},texture:R.create2D,cube:R.createCube,renderbuffer:I.create,framebuffer:$.create,framebufferCube:$.createCube,attributes:v,frame:f,on:function(e,t){var n;switch(e){case"frame":return f(t);case"lost":n=K;break;case"restore":n=J;break;case"destroy":n=Z}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t){n[e]=n[n.length-1],n.pop();break}}}},limits:M,hasExtension:function(e){return 0<=M.extensions.indexOf(e.toLowerCase())},read:x,destroy:function(){V.length=0,o(),G&&(G.removeEventListener("webglcontextlost",a),G.removeEventListener("webglcontextrestored",s)),B.clear(),$.clear(),I.clear(),R.clear(),L.clear(),z.clear(),S&&S.clear(),Z.forEach((function(e){e()}))},_gl:g,_refresh:h,poll:function(){p(),S&&S.update()},now:y,stats:w}),e.onDone(null,v),v}},"object"==typeof n&&void 0!==t?t.exports=r():"function"==typeof define&&define.amd?define(r):this.createREGL=r()},{}],10:[function(e,t,n){(function(e){t.exports=e.performance&&e.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],11:[function(e,t,n){const r=e("./lib/sandbox.js");e("./lib/array-utils.js"),t.exports=class{constructor(e,t,n=[]){this.makeGlobal=t,this.sandbox=r(e),this.parent=e,Object.keys(e).forEach((e=>this.add(e))),this.userProps=n}add(e){this.makeGlobal&&(window[e]=this.parent[e]),this.sandbox.addToContext(e,`parent.${e}`)}set(e,t){this.makeGlobal&&(window[e]=t),this.parent[e]=t}tick(){this.makeGlobal&&this.userProps.forEach((e=>{this.parent[e]=window[e]}))}eval(e){this.sandbox.eval(e)}}},{"./lib/array-utils.js":18,"./lib/sandbox.js":23}],12:[function(e,t,n){const r=e("./glsl-source.js"),i={src:{returnType:"vec4",args:["vec2 _st"]},coord:{returnType:"vec2",args:["vec2 _st"]},color:{returnType:"vec4",args:["vec4 _c0"]},combine:{returnType:"vec4",args:["vec4 _c0","vec4 _c1"]},combineCoord:{returnType:"vec2",args:["vec2 _st","vec4 _c0"]}};t.exports=class{constructor({defaultUniforms:e,defaultOutput:t,extendTransforms:n=[],changeListener:r=(()=>{})}={}){this.defaultOutput=t,this.defaultUniforms=e,this.changeListener=r,this.extendTransforms=n,this.generators={},this.init()}init(){this.glslTransforms={},this.generators=Object.entries(this.generators).reduce(((e,[t,n])=>(this.changeListener({type:"remove",synth:this,method:t}),e)),{}),this.sourceClass=class extends r{};let t=e("./glsl/glsl-functions.js")();return Array.isArray(this.extendTransforms)?t.concat(this.extendTransforms):"object"==typeof this.extendTransforms&&this.extendTransforms.type&&t.push(this.extendTransforms),t.map((e=>this.setFunction(e)))}_addMethod(e,t){if(this.glslTransforms[e]=t,"src"===t.type){const n=(...n)=>new this.sourceClass({name:e,transform:t,userArgs:n,defaultOutput:this.defaultOutput,defaultUniforms:this.defaultUniforms,synth:this});return this.generators[e]=n,this.changeListener({type:"add",synth:this,method:e}),n}this.sourceClass.prototype[e]=function(...n){return this.transforms.push({name:e,transform:t,userArgs:n}),this}}setFunction(e){var t=function(e){let t=i[e.type];if(t){let n=t.args.map((e=>e)).join(", "),r=e.inputs.map((e=>`${e.type} ${e.name}`)).join(", "),i=`${n}${r.length>0?", "+r:""}`,o=`\n  ${t.returnType} ${e.name}(${i}) {\n      ${e.glsl}\n  }\n`;return"combine"!==e.type&&"combineCoord"!==e.type||e.inputs.unshift({name:"color",type:"vec4"}),Object.assign({},e,{glsl:o})}console.warn(`type ${e.type} not recognized`,e)}(e);t&&this._addMethod(e.name,t)}}},{"./glsl-source.js":13,"./glsl/glsl-functions.js":15}],13:[function(e,t,n){const r=e("./glsl-utils.js").generateGlsl,i=(e("./glsl-utils.js").formatArguments,e("./glsl/utility-functions.js"));var o=function(e){return this.transforms=[],this.transforms.push(e),this.defaultOutput=e.defaultOutput,this.synth=e.synth,this.type="GlslSource",this.defaultUniforms=e.defaultUniforms,this};o.prototype.addTransform=function(e){this.transforms.push(e)},o.prototype.out=function(e){var t=e||this.defaultOutput,n=this.glsl(t);if(this.synth.currentFunctions=[],t)try{t.render(n)}catch(e){console.log("shader could not compile",e)}},o.prototype.glsl=function(){var e=[],t=[];return this.transforms.forEach((e=>{"renderpass"===e.transform.type?console.warn("no support for renderpass"):t.push(e)})),t.length>0&&e.push(this.compile(t)),e},o.prototype.compile=function(e){var t=r(e),n={};return t.uniforms.forEach((e=>{n[e.name]=e.value})),{frag:`\n  precision ${this.defaultOutput.precision} float;\n  ${Object.values(t.uniforms).map((e=>{let t=e.type;return"texture"===e.type&&(t="sampler2D"),`\n      uniform ${t} ${e.name};`})).join("")}\n  uniform float time;\n  uniform vec2 resolution;\n  varying vec2 uv;\n  uniform sampler2D prevBuffer;\n\n  ${Object.values(i).map((e=>`\n            ${e.glsl}\n          `)).join("")}\n\n  ${t.glslFunctions.map((e=>`\n            ${e.transform.glsl}\n          `)).join("")}\n\n  void main () {\n    vec4 c = vec4(1, 0, 0, 1);\n    vec2 st = gl_FragCoord.xy/resolution.xy;\n    gl_FragColor = ${t.fragColor};\n  }\n  `,uniforms:Object.assign({},this.defaultUniforms,n)}},t.exports=o},{"./glsl-utils.js":14,"./glsl/utility-functions.js":16}],14:[function(e,t,n){const r=e("./lib/array-utils.js"),i={float:{vec4:{name:"sum",args:[[1,1,1,1]]},vec2:{name:"sum",args:[[1,1]]}}};function o(e,t){var n=()=>"";return e.forEach((e=>{var r=c(e,t.uniforms.length);r.forEach((e=>{e.isUniform&&t.uniforms.push(e)})),function(e,t){for(var n=0;n<t.length;n++)if(e.name==t[n].name)return!0;return!1}(e,t.glslFunctions)||t.glslFunctions.push(e);var i=n;if("src"===e.transform.type)n=n=>`${a(n,e.name,r,t)}`;else if("coord"===e.transform.type)n=n=>`${i(`${a(n,e.name,r,t)}`)}`;else if("color"===e.transform.type)n=n=>`${a(`${i(n)}`,e.name,r,t)}`;else if("combine"===e.transform.type){var s=r[0].value&&r[0].value.transforms?e=>`${o(r[0].value.transforms,t)(e)}`:r[0].isUniform?()=>r[0].name:()=>r[0].value;n=n=>`${a(`${i(n)}, ${s(n)}`,e.name,r.slice(1),t)}`}else"combineCoord"===e.transform.type&&(s=r[0].value&&r[0].value.transforms?e=>`${o(r[0].value.transforms,t)(e)}`:r[0].isUniform?()=>r[0].name:()=>r[0].value,n=n=>`${i(`${a(`${n}, ${s(n)}`,e.name,r.slice(1),t)}`)}`)})),n}function a(e,t,n,r){return`${t}(${e}${n.map((e=>e.isUniform?e.name:e.value&&e.value.transforms?`${o(e.value.transforms,r)("st")}`:e.value)).reduce(((e,t)=>`${e}, ${t}`),"")})`}function s(e,t){for(;e.length<t;)3===e.length?e.push(1):e.push(0);return e.slice(0,t)}t.exports={generateGlsl:function(e){var t={uniforms:[],glslFunctions:[],fragColor:""},n=o(e,t)("st");t.fragColor=n;let r={};return t.uniforms.forEach((e=>r[e.name]=e)),t.uniforms=Object.values(r),t},formatArguments:c};const u=e=>((e=e.toString()).indexOf(".")<0&&(e+="."),e);function c(e,t){const n=e.transform.inputs,o=e.userArgs;return n.map(((e,n)=>{const a={value:e.default,type:e.type,isUniform:!1,name:e.name,vecLen:0};if("float"===a.type&&(a.value=u(e.default)),e.type.startsWith("vec"))try{a.vecLen=Number.parseInt(e.type.substr(3))}catch(t){console.log(`Error determining length of vector input type ${e.type} (${e.name})`)}if(o.length>n&&(a.value=o[n],"function"==typeof o[n]?(a.vecLen>0?a.value=(e,t,r)=>s(o[n](t),a.vecLen):a.value=(t,r,i)=>{try{return o[n](r)}catch(t){return console.log("ERROR",t),e.default}},a.isUniform=!0):o[n].constructor===Array&&(a.vecLen>0?(a.isUniform=!0,a.value=s(a.value,a.vecLen)):(a.value=(e,t,i)=>r.getValue(o[n])(t),a.isUniform=!0))),t<0);else{if(a.value&&a.value.transforms){const t=a.value.transforms[a.value.transforms.length-1];if(t.transform.glsl_return_type!==e.type){const n=i[e.type];if(void 0!==n){const e=n[t.transform.glsl_return_type];if(void 0!==e){const{name:t,args:n}=e;a.value=a.value[t](...n)}}}a.isUniform=!1}else if("float"===a.type&&"number"==typeof a.value)a.value=u(a.value);else if(a.type.startsWith("vec")&&"object"==typeof a.value&&Array.isArray(a.value))a.isUniform=!1,a.value=`${a.type}(${a.value.map(u).join(", ")})`;else if("sampler2D"===e.type){var c=a.value;a.value=()=>c.getTexture(),a.isUniform=!0}else if(a.value.getTexture&&"vec4"===e.type){var f=a.value;a.value=src(f),a.isUniform=!1}a.isUniform&&(a.name+=t)}return a}))}},{"./lib/array-utils.js":18}],15:[function(e,t,n){t.exports=()=>[{name:"noise",type:"src",inputs:[{type:"float",name:"scale",default:10},{type:"float",name:"offset",default:.1}],glsl:"   return vec4(vec3(_noise(vec3(_st*scale, offset*time))), 1.0);"},{name:"voronoi",type:"src",inputs:[{type:"float",name:"scale",default:5},{type:"float",name:"speed",default:.3},{type:"float",name:"blending",default:.3}],glsl:"   vec3 color = vec3(.0);\n   // Scale\n   _st *= scale;\n   // Tile the space\n   vec2 i_st = floor(_st);\n   vec2 f_st = fract(_st);\n   float m_dist = 10.;  // minimun distance\n   vec2 m_point;        // minimum point\n   for (int j=-1; j<=1; j++ ) {\n   for (int i=-1; i<=1; i++ ) {\n   vec2 neighbor = vec2(float(i),float(j));\n   vec2 p = i_st + neighbor;\n   vec2 point = fract(sin(vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3))))*43758.5453);\n   point = 0.5 + 0.5*sin(time*speed + 6.2831*point);\n   vec2 diff = neighbor + point - f_st;\n   float dist = length(diff);\n   if( dist < m_dist ) {\n   m_dist = dist;\n   m_point = point;\n   }\n   }\n   }\n   // Assign a color using the closest point position\n   color += dot(m_point,vec2(.3,.6));\n   color *= 1.0 - blending*m_dist;\n   return vec4(color, 1.0);"},{name:"osc",type:"src",inputs:[{type:"float",name:"frequency",default:60},{type:"float",name:"sync",default:.1},{type:"float",name:"offset",default:0}],glsl:"   vec2 st = _st;\n   float r = sin((st.x-offset/frequency+time*sync)*frequency)*0.5  + 0.5;\n   float g = sin((st.x+time*sync)*frequency)*0.5 + 0.5;\n   float b = sin((st.x+offset/frequency+time*sync)*frequency)*0.5  + 0.5;\n   return vec4(r, g, b, 1.0);"},{name:"shape",type:"src",inputs:[{type:"float",name:"sides",default:3},{type:"float",name:"radius",default:.3},{type:"float",name:"smoothing",default:.01}],glsl:"   vec2 st = _st * 2. - 1.;\n   // Angle and radius from the current pixel\n   float a = atan(st.x,st.y)+3.1416;\n   float r = (2.*3.1416)/sides;\n   float d = cos(floor(.5+a/r)*r-a)*length(st);\n   return vec4(vec3(1.0-smoothstep(radius,radius + smoothing + 0.0000001,d)), 1.0);"},{name:"gradient",type:"src",inputs:[{type:"float",name:"speed",default:0}],glsl:"   return vec4(_st, sin(time*speed), 1.0);"},{name:"src",type:"src",inputs:[{type:"sampler2D",name:"tex",default:NaN}],glsl:"   //  vec2 uv = gl_FragCoord.xy/vec2(1280., 720.);\n   return texture2D(tex, fract(_st));"},{name:"solid",type:"src",inputs:[{type:"float",name:"r",default:0},{type:"float",name:"g",default:0},{type:"float",name:"b",default:0},{type:"float",name:"a",default:1}],glsl:"   return vec4(r, g, b, a);"},{name:"rotate",type:"coord",inputs:[{type:"float",name:"angle",default:10},{type:"float",name:"speed",default:0}],glsl:"   vec2 xy = _st - vec2(0.5);\n   float ang = angle + speed *time;\n   xy = mat2(cos(ang),-sin(ang), sin(ang),cos(ang))*xy;\n   xy += 0.5;\n   return xy;"},{name:"scale",type:"coord",inputs:[{type:"float",name:"amount",default:1.5},{type:"float",name:"xMult",default:1},{type:"float",name:"yMult",default:1},{type:"float",name:"offsetX",default:.5},{type:"float",name:"offsetY",default:.5}],glsl:"   vec2 xy = _st - vec2(offsetX, offsetY);\n   xy*=(1.0/vec2(amount*xMult, amount*yMult));\n   xy+=vec2(offsetX, offsetY);\n   return xy;\n   "},{name:"pixelate",type:"coord",inputs:[{type:"float",name:"pixelX",default:20},{type:"float",name:"pixelY",default:20}],glsl:"   vec2 xy = vec2(pixelX, pixelY);\n   return (floor(_st * xy) + 0.5)/xy;"},{name:"posterize",type:"color",inputs:[{type:"float",name:"bins",default:3},{type:"float",name:"gamma",default:.6}],glsl:"   vec4 c2 = pow(_c0, vec4(gamma));\n   c2 *= vec4(bins);\n   c2 = floor(c2);\n   c2/= vec4(bins);\n   c2 = pow(c2, vec4(1.0/gamma));\n   return vec4(c2.xyz, _c0.a);"},{name:"shift",type:"color",inputs:[{type:"float",name:"r",default:.5},{type:"float",name:"g",default:0},{type:"float",name:"b",default:0},{type:"float",name:"a",default:0}],glsl:"   vec4 c2 = vec4(_c0);\n   c2.r = fract(c2.r + r);\n   c2.g = fract(c2.g + g);\n   c2.b = fract(c2.b + b);\n   c2.a = fract(c2.a + a);\n   return vec4(c2.rgba);"},{name:"repeat",type:"coord",inputs:[{type:"float",name:"repeatX",default:3},{type:"float",name:"repeatY",default:3},{type:"float",name:"offsetX",default:0},{type:"float",name:"offsetY",default:0}],glsl:"   vec2 st = _st * vec2(repeatX, repeatY);\n   st.x += step(1., mod(st.y,2.0)) * offsetX;\n   st.y += step(1., mod(st.x,2.0)) * offsetY;\n   return fract(st);"},{name:"modulateRepeat",type:"combineCoord",inputs:[{type:"float",name:"repeatX",default:3},{type:"float",name:"repeatY",default:3},{type:"float",name:"offsetX",default:.5},{type:"float",name:"offsetY",default:.5}],glsl:"   vec2 st = _st * vec2(repeatX, repeatY);\n   st.x += step(1., mod(st.y,2.0)) + _c0.r * offsetX;\n   st.y += step(1., mod(st.x,2.0)) + _c0.g * offsetY;\n   return fract(st);"},{name:"repeatX",type:"coord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:0}],glsl:"   vec2 st = _st * vec2(reps, 1.0);\n   //  float f =  mod(_st.y,2.0);\n   st.y += step(1., mod(st.x,2.0))* offset;\n   return fract(st);"},{name:"modulateRepeatX",type:"combineCoord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:.5}],glsl:"   vec2 st = _st * vec2(reps, 1.0);\n   //  float f =  mod(_st.y,2.0);\n   st.y += step(1., mod(st.x,2.0)) + _c0.r * offset;\n   return fract(st);"},{name:"repeatY",type:"coord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:0}],glsl:"   vec2 st = _st * vec2(1.0, reps);\n   //  float f =  mod(_st.y,2.0);\n   st.x += step(1., mod(st.y,2.0))* offset;\n   return fract(st);"},{name:"modulateRepeatY",type:"combineCoord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:.5}],glsl:"   vec2 st = _st * vec2(reps, 1.0);\n   //  float f =  mod(_st.y,2.0);\n   st.x += step(1., mod(st.y,2.0)) + _c0.r * offset;\n   return fract(st);"},{name:"kaleid",type:"coord",inputs:[{type:"float",name:"nSides",default:4}],glsl:"   vec2 st = _st;\n   st -= 0.5;\n   float r = length(st);\n   float a = atan(st.y, st.x);\n   float pi = 2.*3.1416;\n   a = mod(a,pi/nSides);\n   a = abs(a-pi/nSides/2.);\n   return r*vec2(cos(a), sin(a));"},{name:"modulateKaleid",type:"combineCoord",inputs:[{type:"float",name:"nSides",default:4}],glsl:"   vec2 st = _st - 0.5;\n   float r = length(st);\n   float a = atan(st.y, st.x);\n   float pi = 2.*3.1416;\n   a = mod(a,pi/nSides);\n   a = abs(a-pi/nSides/2.);\n   return (_c0.r+r)*vec2(cos(a), sin(a));"},{name:"scroll",type:"coord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"scrollY",default:.5},{type:"float",name:"speedX",default:0},{type:"float",name:"speedY",default:0}],glsl:"\n   _st.x += scrollX + time*speedX;\n   _st.y += scrollY + time*speedY;\n   return fract(_st);"},{name:"scrollX",type:"coord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"speed",default:0}],glsl:"   _st.x += scrollX + time*speed;\n   return fract(_st);"},{name:"modulateScrollX",type:"combineCoord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"speed",default:0}],glsl:"   _st.x += _c0.r*scrollX + time*speed;\n   return fract(_st);"},{name:"scrollY",type:"coord",inputs:[{type:"float",name:"scrollY",default:.5},{type:"float",name:"speed",default:0}],glsl:"   _st.y += scrollY + time*speed;\n   return fract(_st);"},{name:"modulateScrollY",type:"combineCoord",inputs:[{type:"float",name:"scrollY",default:.5},{type:"float",name:"speed",default:0}],glsl:"   _st.y += _c0.r*scrollY + time*speed;\n   return fract(_st);"},{name:"add",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return (_c0+_c1)*amount + _c0*(1.0-amount);"},{name:"sub",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return (_c0-_c1)*amount + _c0*(1.0-amount);"},{name:"layer",type:"combine",inputs:[],glsl:"   return vec4(mix(_c0.rgb, _c1.rgb, _c1.a), _c0.a+_c1.a);"},{name:"blend",type:"combine",inputs:[{type:"float",name:"amount",default:.5}],glsl:"   return _c0*(1.0-amount)+_c1*amount;"},{name:"mult",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return _c0*(1.0-amount)+(_c0*_c1)*amount;"},{name:"diff",type:"combine",inputs:[],glsl:"   return vec4(abs(_c0.rgb-_c1.rgb), max(_c0.a, _c1.a));"},{name:"modulate",type:"combineCoord",inputs:[{type:"float",name:"amount",default:.1}],glsl:"   //  return fract(st+(_c0.xy-0.5)*amount);\n   return _st + _c0.xy*amount;"},{name:"modulateScale",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:1},{type:"float",name:"offset",default:1}],glsl:"   vec2 xy = _st - vec2(0.5);\n   xy*=(1.0/vec2(offset + multiple*_c0.r, offset + multiple*_c0.g));\n   xy+=vec2(0.5);\n   return xy;"},{name:"modulatePixelate",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:10},{type:"float",name:"offset",default:3}],glsl:"   vec2 xy = vec2(offset + _c0.x*multiple, offset + _c0.y*multiple);\n   return (floor(_st * xy) + 0.5)/xy;"},{name:"modulateRotate",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:1},{type:"float",name:"offset",default:0}],glsl:"   vec2 xy = _st - vec2(0.5);\n   float angle = offset + _c0.x * multiple;\n   xy = mat2(cos(angle),-sin(angle), sin(angle),cos(angle))*xy;\n   xy += 0.5;\n   return xy;"},{name:"modulateHue",type:"combineCoord",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return _st + (vec2(_c0.g - _c0.r, _c0.b - _c0.g) * amount * 1.0/resolution);"},{name:"invert",type:"color",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return vec4((1.0-_c0.rgb)*amount + _c0.rgb*(1.0-amount), _c0.a);"},{name:"contrast",type:"color",inputs:[{type:"float",name:"amount",default:1.6}],glsl:"   vec4 c = (_c0-vec4(0.5))*vec4(amount) + vec4(0.5);\n   return vec4(c.rgb, _c0.a);"},{name:"brightness",type:"color",inputs:[{type:"float",name:"amount",default:.4}],glsl:"   return vec4(_c0.rgb + vec3(amount), _c0.a);"},{name:"mask",type:"combine",inputs:[],glsl:"   float a = _luminance(_c1.rgb);\n   return vec4(_c0.rgb*a, a);"},{name:"luma",type:"color",inputs:[{type:"float",name:"threshold",default:.5},{type:"float",name:"tolerance",default:.1}],glsl:"   float a = smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb));\n   return vec4(_c0.rgb*a, a);"},{name:"thresh",type:"color",inputs:[{type:"float",name:"threshold",default:.5},{type:"float",name:"tolerance",default:.04}],glsl:"   return vec4(vec3(smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb))), _c0.a);"},{name:"color",type:"color",inputs:[{type:"float",name:"r",default:1},{type:"float",name:"g",default:1},{type:"float",name:"b",default:1},{type:"float",name:"a",default:1}],glsl:"   vec4 c = vec4(r, g, b, a);\n   vec4 pos = step(0.0, c); // detect whether negative\n   // if > 0, return r * _c0\n   // if < 0 return (1.0-r) * _c0\n   return vec4(mix((1.0-_c0)*abs(c), c*_c0, pos));"},{name:"saturate",type:"color",inputs:[{type:"float",name:"amount",default:2}],glsl:"   const vec3 W = vec3(0.2125, 0.7154, 0.0721);\n   vec3 intensity = vec3(dot(_c0.rgb, W));\n   return vec4(mix(intensity, _c0.rgb, amount), _c0.a);"},{name:"hue",type:"color",inputs:[{type:"float",name:"hue",default:.4}],glsl:"   vec3 c = _rgbToHsv(_c0.rgb);\n   c.r += hue;\n   //  c.r = fract(c.r);\n   return vec4(_hsvToRgb(c), _c0.a);"},{name:"colorama",type:"color",inputs:[{type:"float",name:"amount",default:.005}],glsl:"   vec3 c = _rgbToHsv(_c0.rgb);\n   c += vec3(amount);\n   c = _hsvToRgb(c);\n   c = fract(c);\n   return vec4(c, _c0.a);"},{name:"prev",type:"src",inputs:[],glsl:"   return texture2D(prevBuffer, fract(_st));"},{name:"sum",type:"color",inputs:[{type:"vec4",name:"scale",default:1}],glsl:"   vec4 v = _c0 * s;\n   return v.r + v.g + v.b + v.a;\n   }\n   float sum(vec2 _st, vec4 s) { // vec4 is not a typo, because argument type is not overloaded\n   vec2 v = _st.xy * s.xy;\n   return v.x + v.y;"},{name:"r",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.r * scale + offset);"},{name:"g",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.g * scale + offset);"},{name:"b",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.b * scale + offset);"},{name:"a",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.a * scale + offset);"}]},{}],16:[function(e,t,n){t.exports={_luminance:{type:"util",glsl:"float _luminance(vec3 rgb){\n      const vec3 W = vec3(0.2125, 0.7154, 0.0721);\n      return dot(rgb, W);\n    }"},_noise:{type:"util",glsl:"\n    //\tSimplex 3D Noise\n    //\tby Ian McEwan, Ashima Arts\n    vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\n  vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\n\n  float _noise(vec3 v){\n    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n  // First corner\n    vec3 i  = floor(v + dot(v, C.yyy) );\n    vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n  // Other corners\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 i1 = min( g.xyz, l.zxy );\n    vec3 i2 = max( g.xyz, l.zxy );\n\n    //  x0 = x0 - 0. + 0.0 * C\n    vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n    vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n    vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\n  // Permutations\n    i = mod(i, 289.0 );\n    vec4 p = permute( permute( permute(\n               i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n             + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n             + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n  // Gradients\n  // ( N*N points uniformly over a square, mapped onto an octahedron.)\n    float n_ = 1.0/7.0; // N=7\n    vec3  ns = n_ * D.wyz - D.xzx;\n\n    vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n\n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n    vec4 x = x_ *ns.x + ns.yyyy;\n    vec4 y = y_ *ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs(x) - abs(y);\n\n    vec4 b0 = vec4( x.xy, y.xy );\n    vec4 b1 = vec4( x.zw, y.zw );\n\n    vec4 s0 = floor(b0)*2.0 + 1.0;\n    vec4 s1 = floor(b1)*2.0 + 1.0;\n    vec4 sh = -step(h, vec4(0.0));\n\n    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n    vec3 p0 = vec3(a0.xy,h.x);\n    vec3 p1 = vec3(a0.zw,h.y);\n    vec3 p2 = vec3(a1.xy,h.z);\n    vec3 p3 = vec3(a1.zw,h.w);\n\n  //Normalise gradients\n    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n\n  // Mix final noise value\n    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n    m = m * m;\n    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                  dot(p2,x2), dot(p3,x3) ) );\n  }\n    "},_rgbToHsv:{type:"util",glsl:"vec3 _rgbToHsv(vec3 c){\n            vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n            vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n            vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n            float d = q.x - min(q.w, q.y);\n            float e = 1.0e-10;\n            return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n        }"},_hsvToRgb:{type:"util",glsl:"vec3 _hsvToRgb(vec3 c){\n        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n    }"}}},{}],17:[function(e,t,n){const r=e("./lib/webcam.js"),i=e("./lib/screenmedia.js");t.exports=class{constructor({regl:e,width:t,height:n,pb:r,label:i=""}){this.label=i,this.regl=e,this.src=null,this.dynamic=!0,this.width=t,this.height=n,this.tex=this.regl.texture({shape:[1,1]}),this.pb=r}init(e){e.src&&(this.src=e.src,this.tex=this.regl.texture(this.src)),e.dynamic&&(this.dynamic=e.dynamic)}initCam(e){const t=this;r(e).then((e=>{t.src=e.video,t.dynamic=!0,t.tex=t.regl.texture(t.src)})).catch((e=>console.log("could not get camera",e)))}initVideo(e=""){const t=document.createElement("video");t.crossOrigin="anonymous",t.autoplay=!0,t.loop=!0,t.muted=!0,t.addEventListener("loadeddata",(()=>{this.src=t,t.play(),this.tex=this.regl.texture(this.src),this.dynamic=!0})),t.src=e}initImage(e=""){const t=document.createElement("img");t.crossOrigin="anonymous",t.src=e,t.onload=()=>{this.src=t,this.dynamic=!1,this.tex=this.regl.texture(this.src)}}initStream(e){let t=this;e&&this.pb&&(this.pb.initSource(e),this.pb.on("got video",(function(n,r){n===e&&(t.src=r,t.dynamic=!0,t.tex=t.regl.texture(t.src))})))}initScreen(){const e=this;i().then((function(t){e.src=t.video,e.tex=e.regl.texture(e.src),e.dynamic=!0})).catch((e=>console.log("could not get screen",e)))}resize(e,t){this.width=e,this.height=t}clear(){this.src&&this.src.srcObject&&this.src.srcObject.getTracks&&this.src.srcObject.getTracks().forEach((e=>e.stop())),this.src=null,this.tex=this.regl.texture({shape:[1,1]})}tick(e){null!==this.src&&!0===this.dynamic&&(this.src.videoWidth&&this.src.videoWidth!==this.tex.width&&(console.log(this.src.videoWidth,this.src.videoHeight,this.tex.width,this.tex.height),this.tex.resize(this.src.videoWidth,this.src.videoHeight)),this.src.width&&this.src.width!==this.tex.width&&this.tex.resize(this.src.width,this.src.height),this.tex.subimage(this.src))}getTexture(){return this.tex}}},{"./lib/screenmedia.js":24,"./lib/webcam.js":26}],18:[function(e,t,n){var r=e("./easing-functions.js");t.exports={init:()=>{Array.prototype.fast=function(e=1){return this._speed=e,this},Array.prototype.smooth=function(e=1){return this._smooth=e,this},Array.prototype.ease=function(e="linear"){return"function"==typeof e?(this._smooth=1,this._ease=e):r[e]&&(this._smooth=1,this._ease=r[e]),this},Array.prototype.offset=function(e=.5){return this._offset=e%1,this},Array.prototype.fit=function(e=0,t=1){let n=Math.min(...this),r=Math.max(...this);var i=this.map((i=>((e,t,n,r,i)=>(e-t)*(i-r)/(n-t)+r)(i,n,r,e,t)));return i._speed=this._speed,i._smooth=this._smooth,i._ease=this._ease,i}},getValue:(e=[])=>({time:t,bpm:n})=>{let i=e._speed?e._speed:1,o=e._smooth?e._smooth:0,a=t*i*(n/60)+(e._offset||0);if(0!==o){let t=e._ease?e._ease:r.linear,n=a-o/2,i=e[Math.floor(n%e.length)],s=e[Math.floor((n+1)%e.length)];return t(Math.min(n%1/o,1))*(s-i)+i}return e[Math.floor(a%e.length)]}}},{"./easing-functions.js":20}],19:[function(e,t,n){const r=e("meyda");t.exports=class{constructor({numBins:e=4,cutoff:t=2,smooth:n=.4,max:i=15,scale:o=10,isDrawing:a=!1}){this.vol=0,this.scale=o,this.max=i,this.cutoff=t,this.smooth=n,this.setBins(e),this.beat={holdFrames:20,threshold:40,_cutoff:0,decay:.98,_framesSinceBeat:0},this.onBeat=()=>{},this.canvas=document.createElement("canvas"),this.canvas.width=100,this.canvas.height=80,this.canvas.style.width="100px",this.canvas.style.height="80px",this.canvas.style.position="absolute",this.canvas.style.right="0px",this.canvas.style.bottom="0px",document.body.appendChild(this.canvas),this.isDrawing=a,this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#DFFFFF",this.ctx.strokeStyle="#0ff",this.ctx.lineWidth=.5,window.navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then((e=>{this.stream=e,this.context=new AudioContext;let t=this.context.createMediaStreamSource(e);this.meyda=r.createMeydaAnalyzer({audioContext:this.context,source:t,featureExtractors:["loudness"]})})).catch((e=>console.log("ERROR",e)))}detectBeat(e){e>this.beat._cutoff&&e>this.beat.threshold?(this.onBeat(),this.beat._cutoff=1.2*e,this.beat._framesSinceBeat=0):this.beat._framesSinceBeat<=this.beat.holdFrames?this.beat._framesSinceBeat++:(this.beat._cutoff*=this.beat.decay,this.beat._cutoff=Math.max(this.beat._cutoff,this.beat.threshold))}tick(){if(this.meyda){var e=this.meyda.get();if(e&&null!==e){this.vol=e.loudness.total,this.detectBeat(this.vol);const t=(e,t)=>e+t;let n=Math.floor(e.loudness.specific.length/this.bins.length);this.prevBins=this.bins.slice(0),this.bins=this.bins.map(((r,i)=>e.loudness.specific.slice(i*n,(i+1)*n).reduce(t))).map(((e,t)=>e*(1-this.settings[t].smooth)+this.prevBins[t]*this.settings[t].smooth)),this.fft=this.bins.map(((e,t)=>Math.max(0,(e-this.settings[t].cutoff)/this.settings[t].scale))),this.isDrawing&&this.draw()}}}setCutoff(e){this.cutoff=e,this.settings=this.settings.map((t=>(t.cutoff=e,t)))}setSmooth(e){this.smooth=e,this.settings=this.settings.map((t=>(t.smooth=e,t)))}setBins(e){this.bins=Array(e).fill(0),this.prevBins=Array(e).fill(0),this.fft=Array(e).fill(0),this.settings=Array(e).fill(0).map((()=>({cutoff:this.cutoff,scale:this.scale,smooth:this.smooth}))),this.bins.forEach(((e,t)=>{window["a"+t]=(e=1,n=0)=>()=>a.fft[t]*e+n}))}setScale(e){this.scale=e,this.settings=this.settings.map((t=>(t.scale=e,t)))}setMax(e){this.max=e,console.log("set max is deprecated")}hide(){this.isDrawing=!1,this.canvas.style.display="none"}show(){this.isDrawing=!0,this.canvas.style.display="block"}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var e=this.canvas.width/this.bins.length,t=this.canvas.height/(2*this.max);this.bins.forEach(((n,r)=>{var i=n*t;this.ctx.fillRect(r*e,this.canvas.height-i,e,i);var o=this.canvas.height-t*this.settings[r].cutoff;this.ctx.beginPath(),this.ctx.moveTo(r*e,o),this.ctx.lineTo((r+1)*e,o),this.ctx.stroke();var a=this.canvas.height-t*(this.settings[r].scale+this.settings[r].cutoff);this.ctx.beginPath(),this.ctx.moveTo(r*e,a),this.ctx.lineTo((r+1)*e,a),this.ctx.stroke()}))}}},{meyda:5}],20:[function(e,t,n){t.exports={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},sin:function(e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2}}},{}],21:[function(e,t,n){"use strict";n.buttons=function(e){if("object"==typeof e){if("buttons"in e)return e.buttons;if("which"in e){if(2===(t=e.which))return 4;if(3===t)return 2;if(t>0)return 1<<t-1}else if("button"in e){var t;if(1===(t=e.button))return 4;if(2===t)return 2;if(t>=0)return 1<<t}}return 0},n.element=function(e){return e.target||e.srcElement||window},n.x=function(e){return"object"==typeof e&&"pageX"in e?e.pageX:0},n.y=function(e){return"object"==typeof e&&"pageY"in e?e.pageY:0}},{}],22:[function(e,t,n){"use strict";t.exports=function(e,t){t||(t=e,e=window);var n=0,i=0,o=0,a={shift:!1,alt:!1,control:!1,meta:!1},s=!1;function u(e){var t=!1;return"altKey"in e&&(t=t||e.altKey!==a.alt,a.alt=!!e.altKey),"shiftKey"in e&&(t=t||e.shiftKey!==a.shift,a.shift=!!e.shiftKey),"ctrlKey"in e&&(t=t||e.ctrlKey!==a.control,a.control=!!e.ctrlKey),"metaKey"in e&&(t=t||e.metaKey!==a.meta,a.meta=!!e.metaKey),t}function c(e,s){var c=r.x(s),f=r.y(s);"buttons"in s&&(e=0|s.buttons),(e!==n||c!==i||f!==o||u(s))&&(n=0|e,i=c||0,o=f||0,t&&t(n,i,o,a))}function f(e){c(0,e)}function l(){(n||i||o||a.shift||a.alt||a.meta||a.control)&&(i=o=0,n=0,a.shift=a.alt=a.control=a.meta=!1,t&&t(0,0,0,a))}function p(e){u(e)&&t&&t(n,i,o,a)}function h(e){0===r.buttons(e)?c(0,e):c(n,e)}function m(e){c(n|r.buttons(e),e)}function d(e){c(n&~r.buttons(e),e)}function y(){s||(s=!0,e.addEventListener("mousemove",h),e.addEventListener("mousedown",m),e.addEventListener("mouseup",d),e.addEventListener("mouseleave",f),e.addEventListener("mouseenter",f),e.addEventListener("mouseout",f),e.addEventListener("mouseover",f),e.addEventListener("blur",l),e.addEventListener("keyup",p),e.addEventListener("keydown",p),e.addEventListener("keypress",p),e!==window&&(window.addEventListener("blur",l),window.addEventListener("keyup",p),window.addEventListener("keydown",p),window.addEventListener("keypress",p)))}y();var g={element:e};return Object.defineProperties(g,{enabled:{get:function(){return s},set:function(t){t?y():s&&(s=!1,e.removeEventListener("mousemove",h),e.removeEventListener("mousedown",m),e.removeEventListener("mouseup",d),e.removeEventListener("mouseleave",f),e.removeEventListener("mouseenter",f),e.removeEventListener("mouseout",f),e.removeEventListener("mouseover",f),e.removeEventListener("blur",l),e.removeEventListener("keyup",p),e.removeEventListener("keydown",p),e.removeEventListener("keypress",p),e!==window&&(window.removeEventListener("blur",l),window.removeEventListener("keyup",p),window.removeEventListener("keydown",p),window.removeEventListener("keypress",p)))},enumerable:!0},buttons:{get:function(){return n},enumerable:!0},x:{get:function(){return i},enumerable:!0},y:{get:function(){return o},enumerable:!0},mods:{get:function(){return a},enumerable:!0}}),g};var r=e("./mouse-event.js")},{"./mouse-event.js":21}],23:[function(require,module,exports){module.exports=parent=>{var initialCode="",sandbox=createSandbox(initialCode),addToContext=(e,t)=>{sandbox=createSandbox(initialCode+=`\n      var ${e} = ${t}\n    `)};return{addToContext,eval:e=>sandbox.eval(e)};function createSandbox(initial){eval(initial);var localEval=function(code){eval(code)};return{eval:localEval}}}},{}],24:[function(e,t,n){t.exports=function(e){return new Promise((function(t,n){navigator.mediaDevices.getDisplayMedia(e).then((e=>{const n=document.createElement("video");n.srcObject=e,n.addEventListener("loadedmetadata",(()=>{n.play(),t({video:n})}))})).catch((e=>n(e)))}))}},{}],25:[function(e,t,n){t.exports=class{constructor(e){this.mediaSource=new MediaSource,this.stream=e,this.output=document.createElement("video"),this.output.autoplay=!0,this.output.loop=!0;let t=this;this.mediaSource.addEventListener("sourceopen",(()=>{console.log("MediaSource opened"),t.sourceBuffer=t.mediaSource.addSourceBuffer('video/webm; codecs="vp8"'),console.log("Source buffer: ",sourceBuffer)}))}start(){let e={mimeType:"video/webm;codecs=vp9"};this.recordedBlobs=[];try{this.mediaRecorder=new MediaRecorder(this.stream,e)}catch(t){console.log("Unable to create MediaRecorder with options Object: ",t);try{e={mimeType:"video/webm,codecs=vp9"},this.mediaRecorder=new MediaRecorder(this.stream,e)}catch(t){console.log("Unable to create MediaRecorder with options Object: ",t);try{e="video/vp8",this.mediaRecorder=new MediaRecorder(this.stream,e)}catch(e){return alert("MediaRecorder is not supported by this browser.\n\nTry Firefox 29 or later, or Chrome 47 or later, with Enable experimental Web Platform features enabled from chrome://flags."),void console.error("Exception while creating MediaRecorder:",e)}}}console.log("Created MediaRecorder",this.mediaRecorder,"with options",e),this.mediaRecorder.onstop=this._handleStop.bind(this),this.mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this.mediaRecorder.start(100),console.log("MediaRecorder started",this.mediaRecorder)}stop(){this.mediaRecorder.stop()}_handleStop(){const e=new Blob(this.recordedBlobs,{type:this.mediaRecorder.mimeType}),t=window.URL.createObjectURL(e);this.output.src=t;const n=document.createElement("a");n.style.display="none",n.href=t;let r=new Date;n.download=`hydra-${r.getFullYear()}-${r.getMonth()+1}-${r.getDate()}-${r.getHours()}.${r.getMinutes()}.${r.getSeconds()}.webm`,document.body.appendChild(n),n.click(),setTimeout((()=>{document.body.removeChild(n),window.URL.revokeObjectURL(t)}),300)}_handleDataAvailable(e){e.data&&e.data.size>0&&this.recordedBlobs.push(e.data)}}},{}],26:[function(e,t,n){t.exports=function(e){return navigator.mediaDevices.enumerateDevices().then((e=>e.filter((e=>"videoinput"===e.kind)))).then((t=>{let n={audio:!1,video:!0};return t[e]&&(n.video={deviceId:{exact:t[e].deviceId}}),window.navigator.mediaDevices.getUserMedia(n)})).then((e=>{const t=document.createElement("video");return t.srcObject=e,new Promise(((e,n)=>{t.addEventListener("loadedmetadata",(()=>{t.play().then((()=>e({video:t})))}))}))})).catch(console.log.bind(console))}},{}],27:[function(e,t,n){var r=function({regl:e,precision:t,label:n="",width:r,height:i}){this.regl=e,this.precision=t,this.label=n,this.positionBuffer=this.regl.buffer([[-2,0],[0,-2],[2,2]]),this.draw=()=>{},this.init(),this.pingPongIndex=0,this.fbos=Array(2).fill().map((()=>this.regl.framebuffer({color:this.regl.texture({mag:"nearest",width:r,height:i,format:"rgba"}),depthStencil:!1})))};r.prototype.resize=function(e,t){this.fbos.forEach((n=>{n.resize(e,t)}))},r.prototype.getCurrent=function(){return this.fbos[this.pingPongIndex]},r.prototype.getTexture=function(){var e=this.pingPongIndex?0:1;return this.fbos[e]},r.prototype.init=function(){return this.transformIndex=0,this.fragHeader=`\n  precision ${this.precision} float;\n\n  uniform float time;\n  varying vec2 uv;\n  `,this.fragBody="",this.vert=`\n  precision ${this.precision} float;\n  attribute vec2 position;\n  varying vec2 uv;\n\n  void main () {\n    uv = position;\n    gl_Position = vec4(2.0 * position - 1.0, 0, 1);\n  }`,this.attributes={position:this.positionBuffer},this.uniforms={time:this.regl.prop("time"),resolution:this.regl.prop("resolution")},this.frag=`\n       ${this.fragHeader}\n\n      void main () {\n        vec4 c = vec4(0, 0, 0, 0);\n        vec2 st = uv;\n        ${this.fragBody}\n        gl_FragColor = c;\n      }\n  `,this},r.prototype.render=function(e){let t=e[0];var n=this,r=Object.assign(t.uniforms,{prevBuffer:()=>n.fbos[n.pingPongIndex]});n.draw=n.regl({frag:t.frag,vert:n.vert,attributes:n.attributes,uniforms:r,count:3,framebuffer:()=>(n.pingPongIndex=n.pingPongIndex?0:1,n.fbos[n.pingPongIndex])})},r.prototype.tick=function(e){this.draw(e)},t.exports=r},{}]},{},[3])(3)}));